    <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
    <html xmlns="http://www.w3.org/1999/xhtml">
<!--
This file was generated by Devel::NYTProf version 3.11
-->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Content-Language" content="en-us" />
    <title>Profile of /www/svn/logzilla/scripts/db_inse.pl</title>
<link rel="stylesheet" type="text/css" href="style.css" />
    <script type="text/javascript" src="js/jquery-min.js"></script> 

    <script type="text/javascript" src="js/jquery-tablesorter-min.js"></script> 
    <link rel="stylesheet" type="text/css" href="js/style-tablesorter.css" />
    <script type="text/javascript">
    // when a column is first clicked on to sort it, use descending order
    // XXX doesn't seem to work (and not just because the tablesorter formatSortingOrder() is broken)
    $.tablesorter.defaults.sortInitialOrder = "desc";
    // add parser through the tablesorter addParser method 
    $.tablesorter.addParser({
        id: 'fmt_time',   // name of this parser
        is: function(s) { 
            return false; // return false so this parser is not auto detected 
        }, 
        format: function(orig) { // format data for normalization 
            // console.log(orig);
            val = orig.replace(/ns/,'');
            if (val != orig) { return val / (1000*1000*1000); } 
            val = orig.replace(/Âµs/,''); /* XXX use &micro; ? */
            if (val != orig) { return val / (1000*1000); } 
            var val = orig.replace(/ms/,'');
            if (val != orig) { return val / (1000); }
            var val = orig.replace(/s/,'');
            if (val != orig) { return val; }
            if (orig == '0') { return orig; } 
            console.log('no match for fmt_time of '.concat(orig));
            return orig;
        },
        type: 'numeric' // set type, either numeric or text 
    }); 
    </script> 
</head>
<body > 
<div class="header" style="position: relative; overflow-x: hidden; overflow-y: hidden; z-index: 0; ">
<div class="header_back">
            <a href="index.html">&larr; Index</a>
        </div>
<div class="headerForeground" style="float: left">
    <span class="siteTitle">NYTProf Performance Profile</span>
    <span class="siteSubtitle">&emsp;&emsp;<span>&laquo;&emsp;<span class="mode_btn mode_btn_selected">block view</span>&emsp;&bull;&emsp;<span class="mode_btn"><a href="www-svn-logzilla-scripts-db_inse-pl-line.html">line view</a></span>&emsp;&bull;&emsp;<span class="mode_btn"><a href="www-svn-logzilla-scripts-db_inse-pl-sub.html">sub view</a></span>&emsp;&raquo;</span><br />
            For /www/svn/logzilla/scripts/db_inse.pl
        </span>
</div>
<div class="headerForeground" style="float: right; text-align: right">
    <span class="siteTitle">&nbsp;</span>
    <span class="siteSubtitle">Run on Thu Apr 22 13:48:10 2010<br />Reported on Thu Apr 22 13:57:46 2010</span>
</div>
<div style="position: absolute; left: 0px; top: 0%; width: 100%; height: 101%; z-index: -1; background-color: rgb(17, 136, 255); "></div>
<div style="position: absolute; left: 0px; top: 2%; width: 100%; height: 99%; z-index: -1; background-color: rgb(16, 134, 253); "></div>
<div style="position: absolute; left: 0px; top: 4%; width: 100%; height: 97%; z-index: -1; background-color: rgb(16, 133, 252); "></div>
<div style="position: absolute; left: 0px; top: 6%; width: 100%; height: 95%; z-index: -1; background-color: rgb(15, 131, 250); "></div>
<div style="position: absolute; left: 0px; top: 8%; width: 100%; height: 93%; z-index: -1; background-color: rgb(15, 130, 249); "></div>
<div style="position: absolute; left: 0px; top: 10%; width: 100%; height: 91%; z-index: -1; background-color: rgb(15, 129, 248); "></div>
<div style="position: absolute; left: 0px; top: 12%; width: 100%; height: 89%; z-index: -1; background-color: rgb(14, 127, 246); "></div>
<div style="position: absolute; left: 0px; top: 14%; width: 100%; height: 87%; z-index: -1; background-color: rgb(14, 126, 245); "></div>
<div style="position: absolute; left: 0px; top: 16%; width: 100%; height: 85%; z-index: -1; background-color: rgb(14, 125, 244); "></div>
<div style="position: absolute; left: 0px; top: 18%; width: 100%; height: 83%; z-index: -1; background-color: rgb(13, 123, 242); "></div>
<div style="position: absolute; left: 0px; top: 20%; width: 100%; height: 81%; z-index: -1; background-color: rgb(13, 122, 241); "></div>
<div style="position: absolute; left: 0px; top: 22%; width: 100%; height: 79%; z-index: -1; background-color: rgb(13, 121, 240); "></div>
<div style="position: absolute; left: 0px; top: 24%; width: 100%; height: 77%; z-index: -1; background-color: rgb(12, 119, 238); "></div>
<div style="position: absolute; left: 0px; top: 26%; width: 100%; height: 75%; z-index: -1; background-color: rgb(12, 118, 237); "></div>
<div style="position: absolute; left: 0px; top: 28%; width: 100%; height: 73%; z-index: -1; background-color: rgb(12, 116, 235); "></div>
<div style="position: absolute; left: 0px; top: 30%; width: 100%; height: 71%; z-index: -1; background-color: rgb(11, 115, 234); "></div>
<div style="position: absolute; left: 0px; top: 32%; width: 100%; height: 69%; z-index: -1; background-color: rgb(11, 114, 233); "></div>
<div style="position: absolute; left: 0px; top: 34%; width: 100%; height: 67%; z-index: -1; background-color: rgb(11, 112, 231); "></div>
<div style="position: absolute; left: 0px; top: 36%; width: 100%; height: 65%; z-index: -1; background-color: rgb(10, 111, 230); "></div>
<div style="position: absolute; left: 0px; top: 38%; width: 100%; height: 63%; z-index: -1; background-color: rgb(10, 110, 229); "></div>
<div style="position: absolute; left: 0px; top: 40%; width: 100%; height: 61%; z-index: -1; background-color: rgb(10, 108, 227); "></div>
<div style="position: absolute; left: 0px; top: 42%; width: 100%; height: 59%; z-index: -1; background-color: rgb(9, 107, 226); "></div>
<div style="position: absolute; left: 0px; top: 44%; width: 100%; height: 57%; z-index: -1; background-color: rgb(9, 106, 225); "></div>
<div style="position: absolute; left: 0px; top: 46%; width: 100%; height: 55%; z-index: -1; background-color: rgb(9, 104, 223); "></div>
<div style="position: absolute; left: 0px; top: 48%; width: 100%; height: 53%; z-index: -1; background-color: rgb(8, 103, 222); "></div>
<div style="position: absolute; left: 0px; top: 50%; width: 100%; height: 51%; z-index: -1; background-color: rgb(8, 102, 221); "></div>
<div style="position: absolute; left: 0px; top: 52%; width: 100%; height: 49%; z-index: -1; background-color: rgb(8, 100, 219); "></div>
<div style="position: absolute; left: 0px; top: 54%; width: 100%; height: 47%; z-index: -1; background-color: rgb(7, 99, 218); "></div>
<div style="position: absolute; left: 0px; top: 56%; width: 100%; height: 45%; z-index: -1; background-color: rgb(7, 97, 216); "></div>
<div style="position: absolute; left: 0px; top: 58%; width: 100%; height: 43%; z-index: -1; background-color: rgb(7, 96, 215); "></div>
<div style="position: absolute; left: 0px; top: 60%; width: 100%; height: 41%; z-index: -1; background-color: rgb(6, 95, 214); "></div>
<div style="position: absolute; left: 0px; top: 62%; width: 100%; height: 39%; z-index: -1; background-color: rgb(6, 93, 212); "></div>
<div style="position: absolute; left: 0px; top: 64%; width: 100%; height: 37%; z-index: -1; background-color: rgb(6, 92, 211); "></div>
<div style="position: absolute; left: 0px; top: 66%; width: 100%; height: 35%; z-index: -1; background-color: rgb(5, 91, 210); "></div>
<div style="position: absolute; left: 0px; top: 68%; width: 100%; height: 33%; z-index: -1; background-color: rgb(5, 89, 208); "></div>
<div style="position: absolute; left: 0px; top: 70%; width: 100%; height: 31%; z-index: -1; background-color: rgb(5, 88, 207); "></div>
<div style="position: absolute; left: 0px; top: 72%; width: 100%; height: 29%; z-index: -1; background-color: rgb(4, 87, 206); "></div>
<div style="position: absolute; left: 0px; top: 74%; width: 100%; height: 27%; z-index: -1; background-color: rgb(4, 85, 204); "></div>
<div style="position: absolute; left: 0px; top: 76%; width: 100%; height: 25%; z-index: -1; background-color: rgb(4, 84, 203); "></div>
<div style="position: absolute; left: 0px; top: 78%; width: 100%; height: 23%; z-index: -1; background-color: rgb(3, 82, 201); "></div>
<div style="position: absolute; left: 0px; top: 80%; width: 100%; height: 21%; z-index: -1; background-color: rgb(3, 81, 200); "></div>
<div style="position: absolute; left: 0px; top: 82%; width: 100%; height: 19%; z-index: -1; background-color: rgb(3, 80, 199); "></div>
<div style="position: absolute; left: 0px; top: 84%; width: 100%; height: 17%; z-index: -1; background-color: rgb(2, 78, 197); "></div>
<div style="position: absolute; left: 0px; top: 86%; width: 100%; height: 15%; z-index: -1; background-color: rgb(2, 77, 196); "></div>
<div style="position: absolute; left: 0px; top: 88%; width: 100%; height: 13%; z-index: -1; background-color: rgb(2, 76, 195); "></div>
<div style="position: absolute; left: 0px; top: 90%; width: 100%; height: 11%; z-index: -1; background-color: rgb(1, 74, 193); "></div>
<div style="position: absolute; left: 0px; top: 92%; width: 100%; height: 9%; z-index: -1; background-color: rgb(1, 73, 192); "></div>
<div style="position: absolute; left: 0px; top: 94%; width: 100%; height: 7%; z-index: -1; background-color: rgb(1, 72, 191); "></div>
<div style="position: absolute; left: 0px; top: 96%; width: 100%; height: 5%; z-index: -1; background-color: rgb(0, 70, 189); "></div>
<div style="position: absolute; left: 0px; top: 98%; width: 100%; height: 3%; z-index: -1; background-color: rgb(0, 69, 188); "></div>
<div style="position: absolute; left: 0px; top: 100%; width: 100%; height: 1%; z-index: -1; background-color: rgb(0, 68, 187); "></div>
</div>

<div class="body_content">
<br />
<table>
<tr>
<td class="h" align="right">File</td>
<td align="left">/www/svn/logzilla/scripts/db_inse.pl</td>
</tr>
<tr>
<td class="h" align="right">Statements Executed</td>
<td align="left">8116304</td>
</tr>
<tr>
<td class="h" align="right">Statement Execution Time</td>
<td align="left">13.3s</td>
</tr>
</table>

        
        <table id="subs_table" border="1" cellpadding="0" class="tablesorter">
        <caption>Subroutines &mdash; ordered by exclusive time</caption>
        <thead>
        <tr>
        <th>Calls</th>
        <th><span title="Number of Places sub is called from">P</span></th>
        <th><span title="Number of Files sub is called from">F</span></th>
        <th>Exclusive<br />Time</th>
        <th>Inclusive<br />Time</th>
        <th>Subroutine</th>
        </tr>
        </thead>
    <tbody>
<tr><td class="c0">68085</td><td class="c3">1</td><td class="c3">1</td><td class="c0"><span title="1.0%">3.52s</span></td><td class="c0"><span title="1.5%">5.45s</span></td><td class="sub_name"><span style="display: none;">main::::do_msg</span>main::<a href="www-svn-logzilla-scripts-db_inse-pl-block.html#533">do_msg</a></span></td></tr>
<tr><td class="c0">68267</td><td class="c3">1</td><td class="c3">1</td><td class="c0"><span title="0.6%">2.35s</span></td><td class="c0"><span title="3.5%">12.8s</span></td><td class="sub_name"><span style="display: none;">main::::counter</span>main::<a href="www-svn-logzilla-scripts-db_inse-pl-block.html#310">counter</a></span></td></tr>
<tr><td class="c0">206636</td><td class="c0">9</td><td class="c3">1</td><td class="c0"><span title="0.5%">2.00s</span></td><td class="c0"><span title="0.5%">2.00s</span></td><td class="sub_name"><span style="display: none;">main::::yyyymmddhhmmss</span>main::<a href="www-svn-logzilla-scripts-db_inse-pl-block.html#464">yyyymmddhhmmss</a></span></td></tr>
<tr><td class="c0">278327</td><td class="c0">19</td><td class="c3">2</td><td class="c0"><span title="0.2%">668ms</span></td><td class="c0"><span title="0.2%">668ms</span></td><td class="sub_name"><span style="display: none;">main::::CORE:match</span>main::<a href="www-svn-logzilla-scripts-db_inse-pl-block.html#main__CORE_match">CORE:match</a>&nbsp;(opcode)</span></td></tr>
<tr><td class="c0">68267</td><td class="c3">1</td><td class="c3">1</td><td class="c0"><span title="0.1%">346ms</span></td><td class="c0"><span title="3.6%">13.2s</span></td><td class="sub_name"><span style="display: none;">main::::__ANON__[:298]</span>main::<a href="www-svn-logzilla-scripts-db_inse-pl-block.html#292">__ANON__[:298]</a></span></td></tr>
<tr><td class="c0">612765</td><td class="c0">9</td><td class="c3">2</td><td class="c0"><span title="0.1%">259ms</span></td><td class="c0"><span title="0.1%">259ms</span></td><td class="sub_name"><span style="display: none;">main::::CORE:subst</span>main::<a href="www-svn-logzilla-scripts-db_inse-pl-block.html#main__CORE_subst">CORE:subst</a>&nbsp;(opcode)</span></td></tr>
<tr><td class="c0">68085</td><td class="c3">1</td><td class="c3">2</td><td class="c0"><span title="0.0%">103ms</span></td><td class="c0"><span title="0.0%">103ms</span></td><td class="sub_name"><span style="display: none;">main::::CORE:regcomp</span>main::<a href="www-svn-logzilla-scripts-db_inse-pl-block.html#main__CORE_regcomp">CORE:regcomp</a>&nbsp;(opcode)</span></td></tr>
<tr><td class="c3">182</td><td class="c3">1</td><td class="c3">2</td><td class="c1"><span title="0.0%">22.9ms</span></td><td class="c1"><span title="0.0%">22.9ms</span></td><td class="sub_name"><span style="display: none;">main::::CORE:print</span>main::<a href="www-svn-logzilla-scripts-db_inse-pl-block.html#main__CORE_print">CORE:print</a>&nbsp;(opcode)</span></td></tr>
<tr><td class="c3">184</td><td class="c0">3</td><td class="c3">2</td><td class="c3"><span title="0.0%">7.79ms</span></td><td class="c3"><span title="0.0%">7.79ms</span></td><td class="sub_name"><span style="display: none;">main::::CORE:open</span>main::<a href="www-svn-logzilla-scripts-db_inse-pl-block.html#main__CORE_open">CORE:open</a>&nbsp;(opcode)</span></td></tr>
<tr><td class="c3">184</td><td class="c0">3</td><td class="c3">2</td><td class="c3"><span title="0.0%">1.68ms</span></td><td class="c3"><span title="0.0%">1.68ms</span></td><td class="sub_name"><span style="display: none;">main::::CORE:close</span>main::<a href="www-svn-logzilla-scripts-db_inse-pl-block.html#main__CORE_close">CORE:close</a>&nbsp;(opcode)</span></td></tr>
<tr><td class="c2">366</td><td class="c3">1</td><td class="c3">1</td><td class="c3"><span title="0.0%">1.20ms</span></td><td class="c3"><span title="0.0%">1.20ms</span></td><td class="sub_name"><span style="display: none;">main::::round</span>main::<a href="www-svn-logzilla-scripts-db_inse-pl-block.html#516">round</a></span></td></tr>
<tr><td class="c3">1</td><td class="c3">1</td><td class="c3">2</td><td class="c3"><span title="0.0%">22&micro;s</span></td><td class="c3"><span title="0.0%">22&micro;s</span></td><td class="sub_name"><span style="display: none;">main::::CORE:readline</span>main::<a href="www-svn-logzilla-scripts-db_inse-pl-block.html#main__CORE_readline">CORE:readline</a>&nbsp;(opcode)</span></td></tr>
<tr><td class="c3">1</td><td class="c3">1</td><td class="c3">1</td><td class="c3"><span title="0.0%">13&micro;s</span></td><td class="c3"><span title="0.0%">32&micro;s</span></td><td class="sub_name"><span style="display: none;">main::::init</span>main::<a href="www-svn-logzilla-scripts-db_inse-pl-block.html#52">init</a></span></td></tr>
<tr><td class="c3">1</td><td class="c3">1</td><td class="c3">1</td><td class="c3"><span title="0.0%">12&micro;s</span></td><td class="c3"><span title="0.0%">1.19ms</span></td><td class="sub_name"><span style="display: none;">main::::__ANON__[:290]</span>main::<a href="www-svn-logzilla-scripts-db_inse-pl-block.html#280">__ANON__[:290]</a></span></td></tr>
<tr><td class="c3">1</td><td class="c3">1</td><td class="c3">2</td><td class="c3"><span title="0.0%">12&micro;s</span></td><td class="c3"><span title="0.0%">12&micro;s</span></td><td class="sub_name"><span style="display: none;">main::::CORE:mkdir</span>main::<a href="www-svn-logzilla-scripts-db_inse-pl-block.html#main__CORE_mkdir">CORE:mkdir</a>&nbsp;(opcode)</span></td></tr>
<tr><td class="c3">2</td><td class="c1">2</td><td class="c3">2</td><td class="c3"><span title="0.0%">12&micro;s</span></td><td class="c3"><span title="0.0%">12&micro;s</span></td><td class="sub_name"><span style="display: none;">main::::CORE:ftfile</span>main::<a href="www-svn-logzilla-scripts-db_inse-pl-block.html#main__CORE_ftfile">CORE:ftfile</a>&nbsp;(opcode)</span></td></tr>
<tr><td class="c3">1</td><td class="c3">1</td><td class="c3">2</td><td class="c3"><span title="0.0%">7&micro;s</span></td><td class="c3"><span title="0.0%">7&micro;s</span></td><td class="sub_name"><span style="display: none;">main::::CORE:qr</span>main::<a href="www-svn-logzilla-scripts-db_inse-pl-block.html#main__CORE_qr">CORE:qr</a>&nbsp;(opcode)</span></td></tr>
<tr><td class="c3">1</td><td class="c3">1</td><td class="c3">2</td><td class="c3"><span title="0.0%">3&micro;s</span></td><td class="c3"><span title="0.0%">3&micro;s</span></td><td class="sub_name"><span style="display: none;">main::::CORE:ftdir</span>main::<a href="www-svn-logzilla-scripts-db_inse-pl-block.html#main__CORE_ftdir">CORE:ftdir</a>&nbsp;(opcode)</span></td></tr>
<tr><td class="c3">0</td><td class="c3">0</td><td class="c3">0</td><td class="c3"><span title="0.0%">0s</span></td><td class="c3"><span title="0.0%">0s</span></td><td class="sub_name"><span style="display: none;">main::::BEGIN</span>main::<a href="www-svn-logzilla-scripts-db_inse-pl-block.html#53">BEGIN</a></span></td></tr>
<tr><td class="c3">0</td><td class="c3">0</td><td class="c3">0</td><td class="c3"><span title="0.0%">0s</span></td><td class="c3"><span title="0.0%">0s</span></td><td class="sub_name"><span style="display: none;">main::::RUNTIME</span>main::<a href="www-svn-logzilla-scripts-db_inse-pl-block.html#1">RUNTIME</a></span></td></tr>
<tr><td class="c3">0</td><td class="c3">0</td><td class="c3">0</td><td class="c3"><span title="0.0%">0s</span></td><td class="c3"><span title="0.0%">0s</span></td><td class="sub_name"><span style="display: none;">main::::__ANON__[:302]</span>main::<a href="www-svn-logzilla-scripts-db_inse-pl-block.html#300">__ANON__[:302]</a></span></td></tr>
<tr><td class="c3">0</td><td class="c3">0</td><td class="c3">0</td><td class="c3"><span title="0.0%">0s</span></td><td class="c3"><span title="0.0%">0s</span></td><td class="sub_name"><span style="display: none;">main::::bin2dec</span>main::<a href="www-svn-logzilla-scripts-db_inse-pl-block.html#530">bin2dec</a></span></td></tr>
<tr><td class="c3">0</td><td class="c3">0</td><td class="c3">0</td><td class="c3"><span title="0.0%">0s</span></td><td class="c3"><span title="0.0%">0s</span></td><td class="sub_name"><span style="display: none;">main::::dec2bin</span>main::<a href="www-svn-logzilla-scripts-db_inse-pl-block.html#522">dec2bin</a></span></td></tr>
<tr><td class="c3">0</td><td class="c3">0</td><td class="c3">0</td><td class="c3"><span title="0.0%">0s</span></td><td class="c3"><span title="0.0%">0s</span></td><td class="sub_name"><span style="display: none;">main::::usage</span>main::<a href="www-svn-logzilla-scripts-db_inse-pl-block.html#71">usage</a></span></td></tr>

        </tbody>
        </table>
    
        Call graph for these subroutines as a <a href="http://en.wikipedia.org/wiki/Graphviz">Graphviz</a> <a href="www-svn-logzilla-scripts-db_inse-pl.dot">dot language file</a>.
      <table border="1" cellpadding="0">
      <thead>
      <tr><th>Line</th>
      <th><span title="Number of statements executed">State<br />ments</span></th>
      <th><span title="Time spend executing statements on the line,
        excluding time spent executing statements in any called subroutines">Time<br />on line</span></th>
      <th><span title="Number of subroutines calls">Calls</span></th>
      <th><span title="Time spent in subroutines called">Time<br />in subs</span></th>
      <th class="left_indent_header">Code</th>
      </tr>

      </thead>
      <tbody>
    <tr><td class="h"><a name="1"></a>1</td><td></td><td></td><td></td><td></td><td class="s">#!/usr/bin/perl </td></tr>
<tr><td class="h"><a name="2"></a>2</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="3"></a>3</td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h"><a name="4"></a>4</td><td></td><td></td><td></td><td></td><td class="s"># db_insert.pl</td></tr>
<tr><td class="h"><a name="5"></a>5</td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h"><a name="6"></a>6</td><td></td><td></td><td></td><td></td><td class="s"># Developed by Clayton Dukes &lt;cdukes@cdukes.com&gt;</td></tr>
<tr><td class="h"><a name="7"></a>7</td><td></td><td></td><td></td><td></td><td class="s"># Copyright (c) 2009 gdd.net</td></tr>
<tr><td class="h"><a name="8"></a>8</td><td></td><td></td><td></td><td></td><td class="s"># All rights reserved.</td></tr>
<tr><td class="h"><a name="9"></a>9</td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h"><a name="10"></a>10</td><td></td><td></td><td></td><td></td><td class="s"># Changelog:</td></tr>
<tr><td class="h"><a name="11"></a>11</td><td></td><td></td><td></td><td></td><td class="s"># 2009-05-28 - created</td></tr>
<tr><td class="h"><a name="12"></a>12</td><td></td><td></td><td></td><td></td><td class="s"># 2009-09-11 - added a fork to child process to stop I/O blocking which was causing high CPU when dedup was enabled</td></tr>
<tr><td class="h"><a name="13"></a>13</td><td></td><td></td><td></td><td></td><td class="s"># 2009-09-14 - Changed re_pipe to allow for missing prg fields</td></tr>
<tr><td class="h"><a name="14"></a>14</td><td></td><td></td><td></td><td></td><td class="s">#                         - Replaced the incoming date and time with the machine's date and time since not everyone uses NTP</td></tr>
<tr><td class="h"><a name="15"></a>15</td><td></td><td></td><td></td><td></td><td class="s"># 2009-10-09 - Added command line parameters to allow better control when testing</td></tr>
<tr><td class="h"><a name="16"></a>16</td><td></td><td></td><td></td><td></td><td class="s"># 2010-10-10 - Updated to work with LogZilla v3.0</td></tr>
<tr><td class="h"><a name="17"></a>17</td><td></td><td></td><td></td><td></td><td class="s"># 2010-02-23 - Added str2hex conversion - all messages are now stored into the db as HEX.</td></tr>
<tr><td class="h"><a name="18"></a>18</td><td></td><td></td><td></td><td></td><td class="s"># 2010-03-01 - Removed str2hex, unfortunately, while db queries were faster, searching would </td></tr>
<tr><td class="h"><a name="19"></a>19</td><td></td><td></td><td></td><td></td><td class="s">#              only allow for case-sensitive searches and no regex.</td></tr>
<tr><td class="h"><a name="20"></a>20</td><td></td><td></td><td></td><td></td><td class="s"># 2010-04-04 - Removed forking and added load data infile (now able to process spikes up to ~12kmps)</td></tr>
<tr><td class="h"><a name="21"></a>21</td><td></td><td></td><td></td><td></td><td class="s"># 2010-04-12 - Fixed issue with 1s granularity</td></tr>
<tr><td class="h"><a name="22"></a>22</td><td></td><td></td><td></td><td></td><td class="s"># 2010-04-14 - REMOVED Tail::File and daemonize. Calling db_insert.pl directly from syslog-ng provided much better insert rates (now at 20kmps)</td></tr>
<tr><td class="h"><a name="23"></a>23</td><td></td><td></td><td></td><td></td><td class="s"># 2010-04-20 - Replaced re_pipe with better fields from syslog-ng (only need host, pri, ts, prg and msg)</td></tr>
<tr><td class="h"><a name="24"></a>24</td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h"><a name="25"></a>25</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="26"></a>26</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="27"></a>27</td><td class="c0">3</td><td class="c0"><span title="Avg 99&micro;s">298&micro;s</span></td><td class="c3">1</td><td class="c3">5&micro;s</td><td class="s">use strict;<div class="calls"><div class="calls_out"># spent     5&micro;s making 1 call to <a href="strict-pm-block.html#34">strict::import</a></div></div></td></tr>
<tr><td class="h"><a name="28"></a>28</td><td class="c0">3</td><td class="c0"><span title="Avg 35&micro;s">106&micro;s</span></td><td class="c3">1</td><td class="c0">3.51ms</td><td class="s">use POSIX qw/strftime/;<div class="calls"><div class="calls_out"># spent  3.51ms making 1 call to <a href="POSIX-pm-block.html#23">POSIX::import</a></div></div></td></tr>
<tr><td class="h"><a name="29"></a>29</td><td class="c0">3</td><td class="c0"><span title="Avg 39&micro;s">116&micro;s</span></td><td class="c3">1</td><td class="c3">30&micro;s</td><td class="s">use DBI;<div class="calls"><div class="calls_out"># spent    30&micro;s making 1 call to <a href="Exporter-pm-block.html#30">Exporter::import</a></div></div></td></tr>
<tr><td class="h"><a name="30"></a>30</td><td class="c0">3</td><td class="c0"><span title="Avg 43&micro;s">128&micro;s</span></td><td class="c3">1</td><td class="c3">43&micro;s</td><td class="s">use Text::LevenshteinXS qw(distance);<div class="calls"><div class="calls_out"># spent    43&micro;s making 1 call to <a href="Exporter-pm-block.html#30">Exporter::import</a></div></div></td></tr>
<tr><td class="h"><a name="31"></a>31</td><td class="c0">3</td><td class="c0"><span title="Avg 27&micro;s">82&micro;s</span></td><td></td><td></td><td class="s">use File::Spec;</td></tr>
<tr><td class="h"><a name="32"></a>32</td><td class="c0">3</td><td class="c0"><span title="Avg 43&micro;s">128&micro;s</span></td><td class="c3">1</td><td class="c3">48&micro;s</td><td class="s">use File::Basename;<div class="calls"><div class="calls_out"># spent    48&micro;s making 1 call to <a href="Exporter-pm-block.html#30">Exporter::import</a></div></div></td></tr>
<tr><td class="h"><a name="33"></a>33</td><td class="c0">3</td><td class="c0"><span title="Avg 48&micro;s">143&micro;s</span></td><td class="c3">1</td><td class="c3">33&micro;s</td><td class="s">use String::CRC32;<div class="calls"><div class="calls_out"># spent    33&micro;s making 1 call to <a href="Exporter-pm-block.html#30">Exporter::import</a></div></div></td></tr>
<tr><td class="h"><a name="34"></a>34</td><td class="c0">3</td><td class="c0"><span title="Avg 31&micro;s">92&micro;s</span></td><td class="c3">1</td><td class="c0">61.6ms</td><td class="s">use POE;<div class="calls"><div class="calls_out"># spent  61.6ms making 1 call to <a href="POE-pm-block.html#11">POE::import</a></div></div></td></tr>
<tr><td class="h"><a name="35"></a>35</td><td class="c0">3</td><td class="c2"><span title="Avg 7&micro;s">21&micro;s</span></td><td class="c3">1</td><td class="c3">17&micro;s</td><td class="s">use POE::Session;<div class="calls"><div class="calls_out"># spent    17&micro;s making 1 call to <a href="POE-Session-pm-block.html#141">POE::Session::import</a></div></div></td></tr>
<tr><td class="h"><a name="36"></a>36</td><td class="c0">3</td><td class="c0"><span title="Avg 31&micro;s">92&micro;s</span></td><td></td><td></td><td class="s">use POE::Wheel::FollowTail;</td></tr>
<tr><td class="h"><a name="37"></a>37</td><td class="c0">3</td><td class="c0"><span title="Avg 45&micro;s">134&micro;s</span></td><td class="c3">1</td><td class="c0">396&micro;s</td><td class="s">use Log::Log4perl qw(:easy);<div class="calls"><div class="calls_out"># spent   396&micro;s making 1 call to <a href="Log-Log4perl-pm-block.html#69">Log::Log4perl::import</a></div></div></td></tr>
<tr><td class="h"><a name="38"></a>38</td><td class="c3">1</td><td class="c3"><span title="Avg 2&micro;s">2&micro;s</span></td><td></td><td></td><td class="s">$| = 1;</td></tr>
<tr><td class="h"><a name="39"></a>39</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="40"></a>40</td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h"><a name="41"></a>41</td><td></td><td></td><td></td><td></td><td class="s"># Declare variables to use</td></tr>
<tr><td class="h"><a name="42"></a>42</td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h"><a name="43"></a>43</td><td class="c0">3</td><td class="c0"><span title="Avg 16&micro;s">48&micro;s</span></td><td class="c3">1</td><td class="c3">28&micro;s</td><td class="s">use vars qw/ %opt /;<div class="calls"><div class="calls_out"># spent    28&micro;s making 1 call to <a href="vars-pm-block.html#10">vars::import</a></div></div></td></tr>
<tr><td class="h"><a name="44"></a>44</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="45"></a>45</td><td></td><td></td><td></td><td></td><td class="s"># Set command line vars</td></tr>
<tr><td class="h"><a name="46"></a>46</td><td class="c3">1</td><td class="c3"><span title="Avg 1&micro;s">1&micro;s</span></td><td></td><td></td><td class="s">my ($debug, $config, $logfile, $verbose, $dbh, $selftest, $qsize, $alog, $blog);</td></tr>
<tr><td class="h"><a name="47"></a>47</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="48"></a>48</td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h"><a name="49"></a>49</td><td></td><td></td><td></td><td></td><td class="s"># Command line options processing</td></tr>
<tr><td class="h"><a name="50"></a>50</td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h"><a name="51"></a>51</td><td></td><td></td><td></td><td></td><td class="s">sub init()</td></tr>
<tr><td class="h"><a name="52"></a>52</td><td></td><td></td><td></td><td></td><td class="s"><div class="calls"><div class="calls_in"># spent 32&micro;s (13+19) within main::init which was called
#    once (13&micro;s+19&micro;s) by main::RUNTIME at <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#65">line 65</a></div></div>{</td></tr>
<tr><td class="h"><a name="53"></a>53</td><td class="c0">3</td><td class="c0"><span title="Avg 2.06ms">6.18ms</span></td><td class="c3">1</td><td class="c3">53&micro;s</td><td class="s">    use Getopt::Std;<div class="calls"><div class="calls_out">    # spent    53&micro;s making 1 call to <a href="Exporter-pm-block.html#30">Exporter::import</a></div></div></td></tr>
<tr><td class="h"><a name="54"></a>54</td><td class="c0">9</td><td class="c3"><span title="Avg 1&micro;s">10&micro;s</span></td><td></td><td></td><td class="s">    my $opt_string = 'hd:c:l:svq:';</td></tr>
<tr><td class="h"><a name="55"></a>55</td><td></td><td></td><td></td><td></td><td class="s">    getopts( &quot;$opt_string&quot;, \%opt ) or usage();<div class="calls"><div class="calls_out">    # spent    19&micro;s making 1 call to <a href="Getopt-Std-pm-block.html#219">Getopt::Std::getopts</a></div></div></td></tr>
<tr><td class="h"><a name="56"></a>56</td><td></td><td></td><td></td><td></td><td class="s">    usage() if $opt{h};</td></tr>
<tr><td class="h"><a name="57"></a>57</td><td></td><td></td><td></td><td></td><td class="s">    $debug = defined($opt{'d'}) ? $opt{'d'} : '0';</td></tr>
<tr><td class="h"><a name="58"></a>58</td><td></td><td></td><td></td><td></td><td class="s">    $logfile = $opt{'l'} if $opt{'l'};</td></tr>
<tr><td class="h"><a name="59"></a>59</td><td></td><td></td><td></td><td></td><td class="s">    $verbose = $opt{'v'} if $opt{'v'};</td></tr>
<tr><td class="h"><a name="60"></a>60</td><td></td><td></td><td></td><td></td><td class="s">    $qsize = $opt{'q'} if $opt{'q'};</td></tr>
<tr><td class="h"><a name="61"></a>61</td><td></td><td></td><td></td><td></td><td class="s">    $selftest = $opt{'s'} if $opt{'s'};</td></tr>
<tr><td class="h"><a name="62"></a>62</td><td></td><td></td><td></td><td></td><td class="s">    $config = defined($opt{'c'}) ? $opt{'c'} : &quot;/path_to_logzilla/html/config/config.php&quot;;</td></tr>
<tr><td class="h"><a name="63"></a>63</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h"><a name="64"></a>64</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="65"></a>65</td><td class="c3">1</td><td class="c3"><span title="Avg 3&micro;s">3&micro;s</span></td><td class="c3">1</td><td class="c3">32&micro;s</td><td class="s">init();<div class="calls"><div class="calls_out"># spent    32&micro;s making 1 call to <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#52">main::init</a></div></div></td></tr>
<tr><td class="h"><a name="66"></a>66</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="67"></a>67</td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h"><a name="68"></a>68</td><td></td><td></td><td></td><td></td><td class="s"># Help message</td></tr>
<tr><td class="h"><a name="69"></a>69</td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h"><a name="70"></a>70</td><td></td><td></td><td></td><td></td><td class="s">sub usage()</td></tr>
<tr><td class="h"><a name="71"></a>71</td><td></td><td></td><td></td><td></td><td class="s">{</td></tr>
<tr><td class="h"><a name="72"></a>72</td><td></td><td></td><td></td><td></td><td class="s">    print STDERR &lt;&lt; &quot;EOF&quot;;</td></tr>
<tr><td class="h"><a name="73"></a>73</td><td></td><td></td><td></td><td></td><td class="s">This program is used to process incoming syslog messages from a file.</td></tr>
<tr><td class="h"><a name="74"></a>74</td><td></td><td></td><td></td><td></td><td class="s">    usage: $0 [-hdvlcs] </td></tr>
<tr><td class="h"><a name="75"></a>75</td><td></td><td></td><td></td><td></td><td class="s">    -h        : this (help) message</td></tr>
<tr><td class="h"><a name="76"></a>76</td><td></td><td></td><td></td><td></td><td class="s">    -d        : debug level (0-5) (0 = disabled [default])</td></tr>
<tr><td class="h"><a name="77"></a>77</td><td></td><td></td><td></td><td></td><td class="s">    -v        : Also print results to STDOUT</td></tr>
<tr><td class="h"><a name="78"></a>78</td><td></td><td></td><td></td><td></td><td class="s">    -l        : log file (default used from config.php if not set here)</td></tr>
<tr><td class="h"><a name="79"></a>79</td><td></td><td></td><td></td><td></td><td class="s">    -c        : config file (overrides the default config.php file location set in the '\$config' variable in this script)</td></tr>
<tr><td class="h"><a name="80"></a>80</td><td></td><td></td><td></td><td></td><td class="s">    example: $0 -l /var/log/foo.log -d 5 -c /path_to_logzilla/html/config/config.php -v -t /var/log/syslog</td></tr>
<tr><td class="h"><a name="81"></a>81</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="82"></a>82</td><td></td><td></td><td></td><td></td><td class="s">    -s        : **Special Option**: </td></tr>
<tr><td class="h"><a name="83"></a>83</td><td></td><td></td><td></td><td></td><td class="s">            This option may be used to run a self test</td></tr>
<tr><td class="h"><a name="84"></a>84</td><td></td><td></td><td></td><td></td><td class="s">            You can run a self  test by typing:</td></tr>
<tr><td class="h"><a name="85"></a>85</td><td></td><td></td><td></td><td></td><td class="s">            $0 -s -c /path_to_logzilla/html/config/config.php (replace with the path to your config)</td></tr>
<tr><td class="h"><a name="86"></a>86</td><td></td><td></td><td></td><td></td><td class="s">EOF</td></tr>
<tr><td class="h"><a name="87"></a>87</td><td></td><td></td><td></td><td></td><td class="s">    exit;</td></tr>
<tr><td class="h"><a name="88"></a>88</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h"><a name="89"></a>89</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="90"></a>90</td><td class="c3">1</td><td class="c3"><span title="Avg 15&micro;s">15&micro;s</span></td><td class="c3">1</td><td class="c3">10&micro;s</td><td class="s">if (! -f $config) {<div class="calls"><div class="calls_out"># spent    10&micro;s making 1 call to <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#main__CORE_ftfile">main::CORE:ftfile</a></div></div></td></tr>
<tr><td class="h"><a name="91"></a>91</td><td></td><td></td><td></td><td></td><td class="s">    print STDOUT &quot;Can't open config file \&quot;$config\&quot; : $!\nTry $0 -h\n&quot;; </td></tr>
<tr><td class="h"><a name="92"></a>92</td><td></td><td></td><td></td><td></td><td class="s">    exit;</td></tr>
<tr><td class="h"><a name="93"></a>93</td><td></td><td></td><td></td><td></td><td class="s">} </td></tr>
<tr><td class="h"><a name="94"></a>94</td><td class="c3">1</td><td class="c2"><span title="Avg 24&micro;s">24&micro;s</span></td><td class="c3">1</td><td class="c3">19&micro;s</td><td class="s">open( CONFIG, $config );<div class="calls"><div class="calls_out"># spent    19&micro;s making 1 call to <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#main__CORE_open">main::CORE:open</a></div></div></td></tr>
<tr><td class="h"><a name="95"></a>95</td><td class="c3">1</td><td class="c1"><span title="Avg 35&micro;s">35&micro;s</span></td><td class="c3">1</td><td class="c3">22&micro;s</td><td class="s">my @config = &lt;CONFIG&gt;; <div class="calls"><div class="calls_out"># spent    22&micro;s making 1 call to <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#main__CORE_readline">main::CORE:readline</a></div></div></td></tr>
<tr><td class="h"><a name="96"></a>96</td><td class="c3">1</td><td class="c3"><span title="Avg 10&micro;s">10&micro;s</span></td><td class="c3">1</td><td class="c3">6&micro;s</td><td class="s">close( CONFIG );<div class="calls"><div class="calls_out"># spent     6&micro;s making 1 call to <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#main__CORE_close">main::CORE:close</a></div></div></td></tr>
<tr><td class="h"><a name="97"></a>97</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="98"></a>98</td><td class="c3">1</td><td class="c3"><span title="Avg 900ns">900ns</span></td><td></td><td></td><td class="s">my($dbtable,$dbuser,$dbpass,$db,$dbhost,$dbport,$dedup,$dedup_window,$dedup_dist,$log_path,$bulk_ins,$insert_string,@msgs, $q_time, $q_limit,$input_stream);</td></tr>
<tr><td class="h"><a name="99"></a>99</td><td class="c3">1</td><td class="c3"><span title="Avg 1&micro;s">1&micro;s</span></td><td></td><td></td><td class="s">foreach my $var (@config) {</td></tr>
<tr><td class="h"><a name="100"></a>100</td><td class="c0">84</td><td class="c0"><span title="Avg 2&micro;s">187&micro;s</span></td><td class="c0">36</td><td class="c3">21&micro;s</td><td class="s">    next unless $var =~ /^DEFINE/; # read only def's<div class="calls"><div class="calls_out">    # spent    21&micro;s making 36 calls to <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#main__CORE_match">main::CORE:match</a>, avg 594ns/call</div></div></td></tr>
<tr><td class="h"><a name="101"></a>101</td><td></td><td></td><td></td><td></td><td class="s">    $dbuser = $1 if ($var =~ /'DBADMIN', '(\w+)'/);<div class="calls"><div class="calls_out">    # spent     7&micro;s making 8 calls to <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#main__CORE_match">main::CORE:match</a>, avg 913ns/call</div></div></td></tr>
<tr><td class="h"><a name="102"></a>102</td><td></td><td></td><td></td><td></td><td class="s">    $dbpass = $1 if ($var =~ /'DBADMINPW', '(\w+)'/);<div class="calls"><div class="calls_out">    # spent     5&micro;s making 8 calls to <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#main__CORE_match">main::CORE:match</a>, avg 662ns/call</div></div></td></tr>
<tr><td class="h"><a name="103"></a>103</td><td></td><td></td><td></td><td></td><td class="s">    $db = $1 if ($var =~ /'DBNAME', '(\w+)'/);<div class="calls"><div class="calls_out">    # spent     5&micro;s making 8 calls to <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#main__CORE_match">main::CORE:match</a>, avg 663ns/call</div></div></td></tr>
<tr><td class="h"><a name="104"></a>104</td><td></td><td></td><td></td><td></td><td class="s">    $dbhost = $1 if ($var =~ /'DBHOST', '(\w+.*|\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})'/);<div class="calls"><div class="calls_out">    # spent     6&micro;s making 8 calls to <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#main__CORE_match">main::CORE:match</a>, avg 688ns/call</div></div></td></tr>
<tr><td class="h"><a name="105"></a>105</td><td></td><td></td><td></td><td></td><td class="s">    $dbport = $1 if ($var =~ /'DBPORT', '(\w+)'/);<div class="calls"><div class="calls_out">    # spent     5&micro;s making 8 calls to <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#main__CORE_match">main::CORE:match</a>, avg 600ns/call</div></div></td></tr>
<tr><td class="h"><a name="106"></a>106</td><td></td><td></td><td></td><td></td><td class="s">    $input_stream = $1 if ($var =~ /'SRC_STREAM', '(.+)'/);<div class="calls"><div class="calls_out">    # spent     5&micro;s making 8 calls to <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#main__CORE_match">main::CORE:match</a>, avg 650ns/call</div></div></td></tr>
<tr><td class="h"><a name="107"></a>107</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h"><a name="108"></a>108</td><td class="c3">1</td><td class="c3"><span title="Avg 300ns">300ns</span></td><td></td><td></td><td class="s">if (!$db){</td></tr>
<tr><td class="h"><a name="109"></a>109</td><td></td><td></td><td></td><td></td><td class="s">    print &quot;Error: Unable to read $db config variables from $config\n&quot;;</td></tr>
<tr><td class="h"><a name="110"></a>110</td><td></td><td></td><td></td><td></td><td class="s">    exit;</td></tr>
<tr><td class="h"><a name="111"></a>111</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h"><a name="112"></a>112</td><td class="c3">1</td><td class="c3"><span title="Avg 8&micro;s">8&micro;s</span></td><td class="c3">1</td><td class="c0">13.3ms</td><td class="s">$dbh = DBI-&gt;connect( &quot;DBI:mysql:$db:$dbhost&quot;, $dbuser, $dbpass );<div class="calls"><div class="calls_out"># spent  13.3ms making 1 call to <a href="DBI-pm-block.html#551">DBI::connect</a></div></div></td></tr>
<tr><td class="h"><a name="113"></a>113</td><td class="c3">1</td><td class="c3"><span title="Avg 700ns">700ns</span></td><td></td><td></td><td class="s">if (!$dbh) {</td></tr>
<tr><td class="h"><a name="114"></a>114</td><td></td><td></td><td></td><td></td><td class="s">    $blog-&gt;info( &quot;Can't connect to $db database: &quot; . $DBI::errstr . &quot;\n&quot;);</td></tr>
<tr><td class="h"><a name="115"></a>115</td><td></td><td></td><td></td><td></td><td class="s">    $alog-&gt;debug ( &quot;Can't connect to $db database: &quot; . $DBI::errstr . &quot;\n&quot;);</td></tr>
<tr><td class="h"><a name="116"></a>116</td><td></td><td></td><td></td><td></td><td class="s">    exit;</td></tr>
<tr><td class="h"><a name="117"></a>117</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h"><a name="118"></a>118</td><td class="c3">1</td><td class="c3"><span title="Avg 10&micro;s">10&micro;s</span></td><td class="c3">1</td><td class="c1">72&micro;s</td><td class="s">my $sth = $dbh-&gt;prepare(&quot;SELECT name,value FROM settings&quot;);<div class="calls"><div class="calls_out"># spent    72&micro;s making 1 call to <a >DBI::db::prepare</a></div></div></td></tr>
<tr><td class="h"><a name="119"></a>119</td><td class="c3">1</td><td class="c0"><span title="Avg 176&micro;s">176&micro;s</span></td><td class="c3">1</td><td class="c0">166&micro;s</td><td class="s">$sth-&gt;execute();<div class="calls"><div class="calls_out"># spent   166&micro;s making 1 call to <a >DBI::st::execute</a></div></div></td></tr>
<tr><td class="h"><a name="120"></a>120</td><td class="c3">1</td><td class="c2"><span title="Avg 21&micro;s">21&micro;s</span></td><td class="c3">1</td><td class="c3">10&micro;s</td><td class="s">if ($sth-&gt;errstr()) {<div class="calls"><div class="calls_out"># spent    10&micro;s making 1 call to <a >DBI::common::errstr</a></div></div></td></tr>
<tr><td class="h"><a name="121"></a>121</td><td></td><td></td><td></td><td></td><td class="s">    $blog-&gt;info(&quot;FATAL: Unable to execute SQL statement: &quot; . $sth-&gt;errstr() . &quot;\n&quot;);</td></tr>
<tr><td class="h"><a name="122"></a>122</td><td></td><td></td><td></td><td></td><td class="s">    $alog-&gt;debug ( &quot;FATAL: Unable to execute SQL statement: &quot; . $sth-&gt;errstr() . &quot;\n&quot;);</td></tr>
<tr><td class="h"><a name="123"></a>123</td><td></td><td></td><td></td><td></td><td class="s">    exit;</td></tr>
<tr><td class="h"><a name="124"></a>124</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h"><a name="125"></a>125</td><td class="c0">414</td><td class="c0"><span title="Avg 2&micro;s">745&micro;s</span></td><td class="c0">60</td><td class="c0">226&micro;s</td><td class="s">while (my @settings = $sth-&gt;fetchrow_array()) {<div class="calls"><div class="calls_out"># spent   226&micro;s making 60 calls to <a >DBI::st::fetchrow_array</a>, avg 4&micro;s/call</div></div></td></tr>
<tr><td class="h"><a name="126"></a>126</td><td class="c3">1</td><td class="c0"><span title="Avg 406&micro;s">406&micro;s</span></td><td class="c0">59</td><td class="c3">34&micro;s</td><td class="s">    $dbtable = $settings[1] if ($settings[0] =~ /^TBL_MAIN$/);<div class="calls"><div class="calls_out">    # spent    34&micro;s making 59 calls to <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#main__CORE_match">main::CORE:match</a>, avg 576ns/call</div></div></td></tr>
<tr><td class="h"><a name="127"></a>127</td><td></td><td></td><td></td><td></td><td class="s">    #$DEBUG = $settings[1] if ($settings[0] =~ /^DEBUG$/);</td></tr>
<tr><td class="h"><a name="128"></a>128</td><td></td><td></td><td></td><td></td><td class="s">    $dedup = $settings[1] if ($settings[0] =~ /^DEDUP$/);<div class="calls"><div class="calls_out">    # spent    28&micro;s making 59 calls to <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#main__CORE_match">main::CORE:match</a>, avg 480ns/call</div></div></td></tr>
<tr><td class="h"><a name="129"></a>129</td><td></td><td></td><td></td><td></td><td class="s">    $dedup_window = $settings[1] if ($settings[0] =~ /^DEDUP_WINDOW$/);<div class="calls"><div class="calls_out">    # spent    24&micro;s making 59 calls to <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#main__CORE_match">main::CORE:match</a>, avg 414ns/call</div></div></td></tr>
<tr><td class="h"><a name="130"></a>130</td><td></td><td></td><td></td><td></td><td class="s">    $dedup_dist = $settings[1] if ($settings[0] =~ /^DEDUP_DIST$/);<div class="calls"><div class="calls_out">    # spent    24&micro;s making 59 calls to <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#main__CORE_match">main::CORE:match</a>, avg 407ns/call</div></div></td></tr>
<tr><td class="h"><a name="131"></a>131</td><td></td><td></td><td></td><td></td><td class="s">    $log_path = $settings[1] if ($settings[0] =~ /^PATH_LOGS$/);<div class="calls"><div class="calls_out">    # spent    25&micro;s making 59 calls to <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#main__CORE_match">main::CORE:match</a>, avg 425ns/call</div></div></td></tr>
<tr><td class="h"><a name="132"></a>132</td><td></td><td></td><td></td><td></td><td class="s">    $q_time = $settings[1] if ($settings[0] =~ /^Q_TIME$/);<div class="calls"><div class="calls_out">    # spent    26&micro;s making 59 calls to <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#main__CORE_match">main::CORE:match</a>, avg 437ns/call</div></div></td></tr>
<tr><td class="h"><a name="133"></a>133</td><td></td><td></td><td></td><td></td><td class="s">    $q_limit = $settings[1] if ($settings[0] =~ /^Q_LIMIT$/);<div class="calls"><div class="calls_out">    # spent    25&micro;s making 59 calls to <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#main__CORE_match">main::CORE:match</a>, avg 432ns/call</div></div></td></tr>
<tr><td class="h"><a name="134"></a>134</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h"><a name="135"></a>135</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="136"></a>136</td><td></td><td></td><td></td><td></td><td class="s"># If debug is set in the settings table, then increment debug to at least 1</td></tr>
<tr><td class="h"><a name="137"></a>137</td><td></td><td></td><td></td><td></td><td class="s">#if ($DEBUG &gt; &quot;0&quot;) {</td></tr>
<tr><td class="h"><a name="138"></a>138</td><td></td><td></td><td></td><td></td><td class="s">#$debug = $debug + $DEBUG;</td></tr>
<tr><td class="h"><a name="139"></a>139</td><td></td><td></td><td></td><td></td><td class="s">#}</td></tr>
<tr><td class="h"><a name="140"></a>140</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="141"></a>141</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="142"></a>142</td><td></td><td></td><td></td><td></td><td class="s"># Initialize some vars for later use</td></tr>
<tr><td class="h"><a name="143"></a>143</td><td class="c3">1</td><td class="c3"><span title="Avg 500ns">500ns</span></td><td></td><td></td><td class="s">my $insert = 1;</td></tr>
<tr><td class="h"><a name="144"></a>144</td><td class="c3">1</td><td class="c3"><span title="Avg 500ns">500ns</span></td><td></td><td></td><td class="s">my ($distance,$datetime_now,$datetime_past,$fo);</td></tr>
<tr><td class="h"><a name="145"></a>145</td><td class="c3">1</td><td class="c3"><span title="Avg 300ns">300ns</span></td><td></td><td></td><td class="s">my (@rows, @fos, @inserts);</td></tr>
<tr><td class="h"><a name="146"></a>146</td><td class="c3">1</td><td class="c3"><span title="Avg 200ns">200ns</span></td><td></td><td></td><td class="s">my $counter = 1;</td></tr>
<tr><td class="h"><a name="147"></a>147</td><td class="c3">1</td><td class="c1"><span title="Avg 40&micro;s">40&micro;s</span></td><td class="c3">1</td><td class="c3">20&micro;s</td><td class="s">my $datetime = strftime(&quot;%Y-%m-%d %H:%M:%S&quot;, localtime);<div class="calls"><div class="calls_out"># spent    20&micro;s making 1 call to <a href="POSIX-pm-block.html#POSIX__strftime">POSIX::strftime</a></div></div></td></tr>
<tr><td class="h"><a name="148"></a>148</td><td class="c3">1</td><td class="c3"><span title="Avg 400ns">400ns</span></td><td></td><td></td><td class="s">my $message;</td></tr>
<tr><td class="h"><a name="149"></a>149</td><td class="c3">1</td><td class="c3"><span title="Avg 6&micro;s">6&micro;s</span></td><td class="c3">1</td><td class="c0">106&micro;s</td><td class="s">$logfile = &quot;$log_path/&quot;.basename($0, &quot;.pl&quot;).&quot;.log&quot; if not ($logfile);<div class="calls"><div class="calls_out"># spent   106&micro;s making 1 call to <a href="File-Basename-pm-block.html#214">File::Basename::basename</a></div></div></td></tr>
<tr><td class="h"><a name="150"></a>150</td><td class="c3">1</td><td class="c3"><span title="Avg 10&micro;s">10&micro;s</span></td><td class="c3">1</td><td class="c1">72&micro;s</td><td class="s">my $file_path = File::Spec-&gt;rel2abs($0);<div class="calls"><div class="calls_out"># spent    72&micro;s making 1 call to <a href="File-Spec-Unix-pm-block.html#440">File::Spec::Unix::rel2abs</a></div></div></td></tr>
<tr><td class="h"><a name="151"></a>151</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="152"></a>152</td><td class="c3">1</td><td class="c3"><span title="Avg 14&micro;s">14&micro;s</span></td><td class="c3">1</td><td class="c0">7.25ms</td><td class="s">Log::Log4perl-&gt;easy_init(<div class="calls"><div class="calls_out"># spent  7.25ms making 1 call to <a href="Log-Log4perl-pm-block.html#267">Log::Log4perl::easy_init</a></div></div></td></tr>
<tr><td class="h"><a name="153"></a>153</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="154"></a>154</td><td></td><td></td><td></td><td></td><td class="s">{ level   =&gt; $DEBUG,</td></tr>
<tr><td class="h"><a name="155"></a>155</td><td></td><td></td><td></td><td></td><td class="s">  file  =&gt; &quot;STDOUT&quot;,</td></tr>
<tr><td class="h"><a name="156"></a>156</td><td></td><td></td><td></td><td></td><td class="s">category =&gt; 'a',</td></tr>
<tr><td class="h"><a name="157"></a>157</td><td></td><td></td><td></td><td></td><td class="s">},</td></tr>
<tr><td class="h"><a name="158"></a>158</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="159"></a>159</td><td></td><td></td><td></td><td></td><td class="s">{ level   =&gt; $INFO,</td></tr>
<tr><td class="h"><a name="160"></a>160</td><td></td><td></td><td></td><td></td><td class="s">   file    =&gt; &quot;&gt;&gt; $logfile&quot;,</td></tr>
<tr><td class="h"><a name="161"></a>161</td><td></td><td></td><td></td><td></td><td class="s"> category=&gt; 'b',</td></tr>
<tr><td class="h"><a name="162"></a>162</td><td></td><td></td><td></td><td></td><td class="s"> });</td></tr>
<tr><td class="h"><a name="163"></a>163</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="164"></a>164</td><td class="c3">1</td><td class="c3"><span title="Avg 3&micro;s">3&micro;s</span></td><td class="c3">1</td><td class="c3">20&micro;s</td><td class="s">my $alog = Log::Log4perl::get_logger('a');<div class="calls"><div class="calls_out"># spent    20&micro;s making 1 call to <a href="Log-Log4perl-pm-block.html#353">Log::Log4perl::get_logger</a></div></div></td></tr>
<tr><td class="h"><a name="165"></a>165</td><td class="c3">1</td><td class="c3"><span title="Avg 2&micro;s">2&micro;s</span></td><td class="c3">1</td><td class="c3">14&micro;s</td><td class="s">my $blog = Log::Log4perl::get_logger('b');<div class="calls"><div class="calls_out"># spent    14&micro;s making 1 call to <a href="Log-Log4perl-pm-block.html#353">Log::Log4perl::get_logger</a></div></div></td></tr>
<tr><td class="h"><a name="166"></a>166</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="167"></a>167</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="168"></a>168</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="169"></a>169</td><td class="c3">1</td><td class="c3"><span title="Avg 19&micro;s">19&micro;s</span></td><td class="c3">1</td><td class="c3">12&micro;s</td><td class="s">mkdir $log_path;<div class="calls"><div class="calls_out"># spent    12&micro;s making 1 call to <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#main__CORE_mkdir">main::CORE:mkdir</a></div></div></td></tr>
<tr><td class="h"><a name="170"></a>170</td><td class="c3">1</td><td class="c3"><span title="Avg 8&micro;s">8&micro;s</span></td><td class="c3">1</td><td class="c3">3&micro;s</td><td class="s">if (! -d $log_path) {<div class="calls"><div class="calls_out"># spent     3&micro;s making 1 call to <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#main__CORE_ftdir">main::CORE:ftdir</a></div></div></td></tr>
<tr><td class="h"><a name="171"></a>171</td><td></td><td></td><td></td><td></td><td class="s">    $alog-&gt;debug ( &quot;Failed to create $log_path: $!\n&quot;);</td></tr>
<tr><td class="h"><a name="172"></a>172</td><td></td><td></td><td></td><td></td><td class="s">    exit;</td></tr>
<tr><td class="h"><a name="173"></a>173</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h"><a name="174"></a>174</td><td></td><td></td><td></td><td></td><td class="s">#open(LOG,&quot;&gt;&gt;$logfile&quot;);</td></tr>
<tr><td class="h"><a name="175"></a>175</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="176"></a>176</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="177"></a>177</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="178"></a>178</td><td class="c3">1</td><td class="c3"><span title="Avg 6&micro;s">6&micro;s</span></td><td class="c3">1</td><td class="c3">2&micro;s</td><td class="s">if (! -f $logfile) {<div class="calls"><div class="calls_out"># spent     2&micro;s making 1 call to <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#main__CORE_ftfile">main::CORE:ftfile</a></div></div></td></tr>
<tr><td class="h"><a name="179"></a>179</td><td></td><td></td><td></td><td></td><td class="s">    $alog-&gt;debug(&quot;Unable to open log file \&quot;$logfile\&quot; for writing...$!\n&quot;);</td></tr>
<tr><td class="h"><a name="180"></a>180</td><td></td><td></td><td></td><td></td><td class="s">    exit;</td></tr>
<tr><td class="h"><a name="181"></a>181</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h"><a name="182"></a>182</td><td></td><td></td><td></td><td></td><td class="s">#select(LOG);</td></tr>
<tr><td class="h"><a name="183"></a>183</td><td class="c3">1</td><td class="c3"><span title="Avg 9&micro;s">9&micro;s</span></td><td class="c3">1</td><td class="c0">269&micro;s</td><td class="s">$blog-&gt;info(&quot;\n$datetime\nStarting $logfile for $file_path at pid $$\nUsing Database: $db\n&quot;);<div class="calls"><div class="calls_out"># spent   269&micro;s making 1 call to <a href="Log-Log4perl-Logger-pm-block.html#778">Log::Log4perl::Logger::__ANON__[Log/Log4perl/Logger.pm:786]</a></div></div></td></tr>
<tr><td class="h"><a name="184"></a>184</td><td class="c3">1</td><td class="c3"><span title="Avg 2&micro;s">2&micro;s</span></td><td></td><td></td><td class="s">$alog-&gt;debug(&quot;\n$datetime\nStarting $logfile for $file_path at pid $$\nUsing Database: $db\n&quot;) if (($debug &gt; 0) and ($verbose));</td></tr>
<tr><td class="h"><a name="185"></a>185</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="186"></a>186</td><td class="c3">1</td><td class="c3"><span title="Avg 600ns">600ns</span></td><td></td><td></td><td class="s">if (($debug &gt; 0) or ($verbose)) { </td></tr>
<tr><td class="h"><a name="187"></a>187</td><td></td><td></td><td></td><td></td><td class="s">    $alog-&gt;debug(&quot;Debug level: $debug\nTable: $dbtable\nAdminuser: $dbuser\nPW: $dbpass\nDB: $db\nDB Host: $dbhost\nDB Port: $dbport\nDeduplication Feature = $dedup\nLogging results to $logfile\nPrinting results to screen (STDOUT)\n&quot;);</td></tr>
<tr><td class="h"><a name="188"></a>188</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h"><a name="189"></a>189</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="190"></a>190</td><td class="c3">1</td><td class="c3"><span title="Avg 1&micro;s">1&micro;s</span></td><td></td><td></td><td class="s">my ($host, %host_cache, $facility, $pri, $unixtime, $prg, %program_cache, $prg32, $msg, $mne, %mne_cache, $mne32, $severity); </td></tr>
<tr><td class="h"><a name="191"></a>191</td><td class="c3">1</td><td class="c3"><span title="Avg 12&micro;s">12&micro;s</span></td><td class="c3">1</td><td class="c3">7&micro;s</td><td class="s">my $re_pipe = qr/(\S+)\t(\d+)\t(\d+)\t(\S+)\t(.*)/;<div class="calls"><div class="calls_out"># spent     7&micro;s making 1 call to <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#main__CORE_qr">main::CORE:qr</a></div></div></td></tr>
<tr><td class="h"><a name="192"></a>192</td><td></td><td></td><td></td><td></td><td class="s"># v3.0 Fields are: Host, PRI, Unix TS, Program,  and MSG</td></tr>
<tr><td class="h"><a name="193"></a>193</td><td></td><td></td><td></td><td></td><td class="s"># the $severity and $facility fields are split from the $pri coming in so that they can be stored as integers into 2 separate db columns</td></tr>
<tr><td class="h"><a name="194"></a>194</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="195"></a>195</td><td class="c3">1</td><td class="c0"><span title="Avg 96&micro;s">96&micro;s</span></td><td class="c3">1</td><td class="c1">84&micro;s</td><td class="s">$dbh-&gt;disconnect();<div class="calls"><div class="calls_out"># spent    84&micro;s making 1 call to <a >DBI::db::disconnect</a></div></div></td></tr>
<tr><td class="h"><a name="196"></a>196</td><td class="c3">1</td><td class="c3"><span title="Avg 15&micro;s">15&micro;s</span></td><td class="c3">1</td><td class="c0">926&micro;s</td><td class="s">$dbh = DBI-&gt;connect( &quot;DBI:mysql:$db:$dbhost&quot;, $dbuser, $dbpass );<div class="calls"><div class="calls_out"># spent   926&micro;s making 1 call to <a href="DBI-pm-block.html#551">DBI::connect</a></div></div></td></tr>
<tr><td class="h"><a name="197"></a>197</td><td class="c3">1</td><td class="c3"><span title="Avg 600ns">600ns</span></td><td></td><td></td><td class="s">if (!$dbh) {</td></tr>
<tr><td class="h"><a name="198"></a>198</td><td></td><td></td><td></td><td></td><td class="s">    $blog-&gt;info(&quot;Can't connect to $db database: &quot; . $DBI::errstr . &quot;\n&quot;);</td></tr>
<tr><td class="h"><a name="199"></a>199</td><td></td><td></td><td></td><td></td><td class="s">    $alog-&gt;debug(&quot;Can't connect to $db database: &quot; . $DBI::errstr );</td></tr>
<tr><td class="h"><a name="200"></a>200</td><td></td><td></td><td></td><td></td><td class="s">    exit;</td></tr>
<tr><td class="h"><a name="201"></a>201</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h"><a name="202"></a>202</td><td class="c3">1</td><td class="c3"><span title="Avg 11&micro;s">11&micro;s</span></td><td class="c3">1</td><td class="c3">49&micro;s</td><td class="s">my $db_select = $dbh-&gt;prepare(&quot;SELECT id,msg FROM $dbtable WHERE host=? AND facility=? AND severity=? AND program=? AND fo BETWEEN ? AND ?&quot;);<div class="calls"><div class="calls_out"># spent    49&micro;s making 1 call to <a >DBI::db::prepare</a></div></div></td></tr>
<tr><td class="h"><a name="203"></a>203</td><td class="c3">1</td><td class="c3"><span title="Avg 9&micro;s">9&micro;s</span></td><td class="c3">1</td><td class="c3">37&micro;s</td><td class="s">my $db_select_id = $dbh-&gt;prepare(&quot;SELECT counter,fo,lo FROM $dbtable WHERE id=?&quot;);<div class="calls"><div class="calls_out"># spent    37&micro;s making 1 call to <a >DBI::db::prepare</a></div></div></td></tr>
<tr><td class="h"><a name="204"></a>204</td><td class="c3">1</td><td class="c3"><span title="Avg 8&micro;s">8&micro;s</span></td><td class="c3">1</td><td class="c3">32&micro;s</td><td class="s">my $db_update = $dbh-&gt;prepare(&quot;UPDATE $dbtable SET counter=?, fo=?, lo=? WHERE id=?&quot;);<div class="calls"><div class="calls_out"># spent    32&micro;s making 1 call to <a >DBI::db::prepare</a></div></div></td></tr>
<tr><td class="h"><a name="205"></a>205</td><td class="c3">1</td><td class="c3"><span title="Avg 11&micro;s">11&micro;s</span></td><td class="c3">1</td><td class="c3">31&micro;s</td><td class="s">my $db_del = $dbh-&gt;prepare(&quot;DELETE FROM $dbtable WHERE id=?&quot;);<div class="calls"><div class="calls_out"># spent    31&micro;s making 1 call to <a >DBI::db::prepare</a></div></div></td></tr>
<tr><td class="h"><a name="206"></a>206</td><td class="c3">1</td><td class="c3"><span title="Avg 9&micro;s">9&micro;s</span></td><td class="c3">1</td><td class="c3">39&micro;s</td><td class="s">my $db_insert = $dbh-&gt;prepare(&quot;INSERT INTO $dbtable (host,facility,severity,program,msg,mne,fo,lo) VALUES (?,?,?,?,?,?,?,?)&quot;);<div class="calls"><div class="calls_out"># spent    39&micro;s making 1 call to <a >DBI::db::prepare</a></div></div></td></tr>
<tr><td class="h"><a name="207"></a>207</td><td class="c3">1</td><td class="c3"><span title="Avg 7&micro;s">7&micro;s</span></td><td class="c3">1</td><td class="c3">36&micro;s</td><td class="s">my $db_insert_prg = $dbh-&gt;prepare(&quot;INSERT IGNORE INTO programs (name,crc) VALUES (?,?) &quot;);<div class="calls"><div class="calls_out"># spent    36&micro;s making 1 call to <a >DBI::db::prepare</a></div></div></td></tr>
<tr><td class="h"><a name="208"></a>208</td><td class="c3">1</td><td class="c3"><span title="Avg 8&micro;s">8&micro;s</span></td><td class="c3">1</td><td class="c3">34&micro;s</td><td class="s">my $db_insert_mne = $dbh-&gt;prepare(&quot;INSERT IGNORE INTO mne (name,crc) VALUES (?,?) &quot;);<div class="calls"><div class="calls_out"># spent    34&micro;s making 1 call to <a >DBI::db::prepare</a></div></div></td></tr>
<tr><td class="h"><a name="209"></a>209</td><td class="c3">1</td><td class="c3"><span title="Avg 7&micro;s">7&micro;s</span></td><td class="c3">1</td><td class="c3">30&micro;s</td><td class="s">my $db_insert_host = $dbh-&gt;prepare(&quot;INSERT IGNORE INTO hosts (host) VALUES (?) &quot;);<div class="calls"><div class="calls_out"># spent    30&micro;s making 1 call to <a >DBI::db::prepare</a></div></div></td></tr>
<tr><td class="h"><a name="210"></a>210</td><td class="c3">1</td><td class="c3"><span title="Avg 1&micro;s">1&micro;s</span></td><td></td><td></td><td class="s">my $dumpfile = &quot;/dev/shm/infile.txt&quot;;</td></tr>
<tr><td class="h"><a name="211"></a>211</td><td class="c3">1</td><td class="c3"><span title="Avg 2&micro;s">2&micro;s</span></td><td></td><td></td><td class="s">my $sql = qq{LOAD DATA LOCAL INFILE '$dumpfile' INTO TABLE logs FIELDS TERMINATED BY &quot;\\t&quot; LINES TERMINATED BY &quot;\\n&quot; (host,facility,severity,program,msg,mne,fo,lo)};</td></tr>
<tr><td class="h"><a name="212"></a>212</td><td class="c3">1</td><td class="c3"><span title="Avg 7&micro;s">7&micro;s</span></td><td class="c3">1</td><td class="c3">30&micro;s</td><td class="s">my $db_insert_mpX = $dbh-&gt;prepare(&quot;REPLACE INTO cache (name,value,updatetime) VALUES (?,?,?)&quot;);<div class="calls"><div class="calls_out"># spent    30&micro;s making 1 call to <a >DBI::db::prepare</a></div></div></td></tr>
<tr><td class="h"><a name="213"></a>213</td><td class="c3">1</td><td class="c3"><span title="Avg 7&micro;s">7&micro;s</span></td><td class="c3">1</td><td class="c3">38&micro;s</td><td class="s">my $db_insert_sum = $dbh-&gt;prepare(&quot;INSERT INTO cache (name,value,updatetime) VALUES ('msg_sum',?,?) ON DUPLICATE KEY UPDATE value=value + ?&quot;);<div class="calls"><div class="calls_out"># spent    38&micro;s making 1 call to <a >DBI::db::prepare</a></div></div></td></tr>
<tr><td class="h"><a name="214"></a>214</td><td class="c3">1</td><td class="c3"><span title="Avg 8&micro;s">8&micro;s</span></td><td class="c3">1</td><td class="c3">32&micro;s</td><td class="s">my $db_load = $dbh-&gt;prepare(&quot;$sql&quot;);<div class="calls"><div class="calls_out"># spent    32&micro;s making 1 call to <a >DBI::db::prepare</a></div></div></td></tr>
<tr><td class="h"><a name="215"></a>215</td><td class="c3">1</td><td class="c3"><span title="Avg 200ns">200ns</span></td><td></td><td></td><td class="s">my $queue;</td></tr>
<tr><td class="h"><a name="216"></a>216</td><td class="c3">1</td><td class="c3"><span title="Avg 400ns">400ns</span></td><td></td><td></td><td class="s">my @dumparr;</td></tr>
<tr><td class="h"><a name="217"></a>217</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="218"></a>218</td><td class="c3">1</td><td class="c3"><span title="Avg 900ns">900ns</span></td><td></td><td></td><td class="s">my $start_time = (time);</td></tr>
<tr><td class="h"><a name="219"></a>219</td><td class="c3">1</td><td class="c3"><span title="Avg 400ns">400ns</span></td><td></td><td></td><td class="s">my $end_time;</td></tr>
<tr><td class="h"><a name="220"></a>220</td><td class="c3">1</td><td class="c3"><span title="Avg 2&micro;s">2&micro;s</span></td><td></td><td></td><td class="s">my $time_limit = ($start_time + $q_time);</td></tr>
<tr><td class="h"><a name="221"></a>221</td><td class="c3">1</td><td class="c3"><span title="Avg 300ns">300ns</span></td><td></td><td></td><td class="s">my $mps_timer_start = $start_time;</td></tr>
<tr><td class="h"><a name="222"></a>222</td><td class="c3">1</td><td class="c3"><span title="Avg 800ns">800ns</span></td><td></td><td></td><td class="s">my ($do_msg_mps, $mps, $tmp_mps, @mps, $sec);</td></tr>
<tr><td class="h"><a name="223"></a>223</td><td class="c3">1</td><td class="c3"><span title="Avg 700ns">700ns</span></td><td></td><td></td><td class="s">my ($mpm, @mpm, $min);</td></tr>
<tr><td class="h"><a name="224"></a>224</td><td class="c3">1</td><td class="c3"><span title="Avg 700ns">700ns</span></td><td></td><td></td><td class="s">my ($mph, @mph, $hr);</td></tr>
<tr><td class="h"><a name="225"></a>225</td><td class="c3">1</td><td class="c3"><span title="Avg 500ns">500ns</span></td><td></td><td></td><td class="s">my ($mpd, @mpd, $day);</td></tr>
<tr><td class="h"><a name="226"></a>226</td><td class="c3">1</td><td class="c3"><span title="Avg 200ns">200ns</span></td><td></td><td></td><td class="s">my $sumcount;</td></tr>
<tr><td class="h"><a name="227"></a>227</td><td class="c3">1</td><td class="c3"><span title="Avg 200ns">200ns</span></td><td></td><td></td><td class="s">my $now;</td></tr>
<tr><td class="h"><a name="228"></a>228</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="229"></a>229</td><td class="c3">1</td><td class="c0"><span title="Avg 43&micro;s">43&micro;s</span></td><td class="c3">1</td><td class="c3">36&micro;s</td><td class="s">open (DUMP, &quot;&gt;$dumpfile&quot;) or die &quot;can't open $dumpfile: $!\n&quot;;<div class="calls"><div class="calls_out"># spent    36&micro;s making 1 call to <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#main__CORE_open">main::CORE:open</a></div></div></td></tr>
<tr><td class="h"><a name="230"></a>230</td><td class="c3">1</td><td class="c3"><span title="Avg 7&micro;s">7&micro;s</span></td><td class="c3">1</td><td class="c3">4&micro;s</td><td class="s">close (DUMP);<div class="calls"><div class="calls_out"># spent     4&micro;s making 1 call to <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#main__CORE_close">main::CORE:close</a></div></div></td></tr>
<tr><td class="h"><a name="231"></a>231</td><td class="c3">1</td><td class="c3"><span title="Avg 900ns">900ns</span></td><td></td><td></td><td class="s">$db_load-&gt;{TraceLevel} = 4 if (($debug &gt; 4) and ($verbose));</td></tr>
<tr><td class="h"><a name="232"></a>232</td><td class="c3">1</td><td class="c3"><span title="Avg 500ns">500ns</span></td><td></td><td></td><td class="s">if ($selftest) {</td></tr>
<tr><td class="h"><a name="233"></a>233</td><td></td><td></td><td></td><td></td><td class="s">    my $sth = $dbh-&gt;prepare(&quot;</td></tr>
<tr><td class="h"><a name="234"></a>234</td><td></td><td></td><td></td><td></td><td class="s">        DELETE from $dbtable where tag='dbins_tag';</td></tr>
<tr><td class="h"><a name="235"></a>235</td><td></td><td></td><td></td><td></td><td class="s">        &quot;) or die &quot;Could not delete old test results: $DBI::errstr&quot;;</td></tr>
<tr><td class="h"><a name="236"></a>236</td><td></td><td></td><td></td><td></td><td class="s">    $sth-&gt;execute;</td></tr>
<tr><td class="h"><a name="237"></a>237</td><td></td><td></td><td></td><td></td><td class="s">    my $cmd = &quot;$0&quot;;</td></tr>
<tr><td class="h"><a name="238"></a>238</td><td></td><td></td><td></td><td></td><td class="s">    $cmd .= &quot; -d 3&quot;; # Force debug on so test results are shown </td></tr>
<tr><td class="h"><a name="239"></a>239</td><td></td><td></td><td></td><td></td><td class="s">    $cmd .= &quot; -c &quot; . $opt{'c'} if $opt{'c'};</td></tr>
<tr><td class="h"><a name="240"></a>240</td><td></td><td></td><td></td><td></td><td class="s">    $cmd .= &quot; -l &quot; . $opt{'l'} if $opt{'l'};</td></tr>
<tr><td class="h"><a name="241"></a>241</td><td></td><td></td><td></td><td></td><td class="s">    $cmd .= &quot; -v &quot;; # Force verbose mode so results are printed to screen</td></tr>
<tr><td class="h"><a name="242"></a>242</td><td></td><td></td><td></td><td></td><td class="s">    $alog-&gt;debug(&quot;\nPERFORMING SELF TEST USING COMMAND: $cmd\n\n&quot;);</td></tr>
<tr><td class="h"><a name="243"></a>243</td><td></td><td></td><td></td><td></td><td class="s">    my $res = `printf &quot;\n&quot; | $cmd -q 1`;</td></tr>
<tr><td class="h"><a name="244"></a>244</td><td></td><td></td><td></td><td></td><td class="s">    $alog-&gt;debug(&quot;Database Lookup (resulting message should be from Fred):\n&quot;);</td></tr>
<tr><td class="h"><a name="245"></a>245</td><td></td><td></td><td></td><td></td><td class="s">    my $sth = $dbh-&gt;prepare(&quot;</td></tr>
<tr><td class="h"><a name="246"></a>246</td><td></td><td></td><td></td><td></td><td class="s">        SELECT msg FROM $dbtable ORDER BY id DESC LIMIT 1;</td></tr>
<tr><td class="h"><a name="247"></a>247</td><td></td><td></td><td></td><td></td><td class="s">        &quot;) or die &quot;Could not fetch last row: $DBI::errstr&quot;;</td></tr>
<tr><td class="h"><a name="248"></a>248</td><td></td><td></td><td></td><td></td><td class="s">    $sth-&gt;execute;</td></tr>
<tr><td class="h"><a name="249"></a>249</td><td></td><td></td><td></td><td></td><td class="s">    if (my $res = $sth-&gt;fetchrow_array() ) {</td></tr>
<tr><td class="h"><a name="250"></a>250</td><td></td><td></td><td></td><td></td><td class="s">        $alog-&gt;debug( &quot;$res\nSELF TEST COMPLETE!\n&quot;);</td></tr>
<tr><td class="h"><a name="251"></a>251</td><td></td><td></td><td></td><td></td><td class="s">    } else {</td></tr>
<tr><td class="h"><a name="252"></a>252</td><td></td><td></td><td></td><td></td><td class="s">        $alog-&gt;debug(&quot;Test Failed\n&quot;);</td></tr>
<tr><td class="h"><a name="253"></a>253</td><td></td><td></td><td></td><td></td><td class="s">    }</td></tr>
<tr><td class="h"><a name="254"></a>254</td><td></td><td></td><td></td><td></td><td class="s">    exit;</td></tr>
<tr><td class="h"><a name="255"></a>255</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h"><a name="256"></a>256</td><td class="c3">1</td><td class="c3"><span title="Avg 300ns">300ns</span></td><td></td><td></td><td class="s">if ($qsize) {</td></tr>
<tr><td class="h"><a name="257"></a>257</td><td></td><td></td><td></td><td></td><td class="s">    $q_limit = $qsize;</td></tr>
<tr><td class="h"><a name="258"></a>258</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h"><a name="259"></a>259</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="260"></a>260</td><td></td><td></td><td></td><td></td><td class="s"># Pre-populate cache's with db values</td></tr>
<tr><td class="h"><a name="261"></a>261</td><td class="c3">1</td><td class="c3"><span title="Avg 9&micro;s">9&micro;s</span></td><td class="c3">1</td><td class="c3">39&micro;s</td><td class="s">my $prg_select = $dbh-&gt;prepare(&quot;SELECT * FROM programs&quot;);<div class="calls"><div class="calls_out"># spent    39&micro;s making 1 call to <a >DBI::db::prepare</a></div></div></td></tr>
<tr><td class="h"><a name="262"></a>262</td><td class="c3">1</td><td class="c0"><span title="Avg 127&micro;s">127&micro;s</span></td><td class="c3">1</td><td class="c0">119&micro;s</td><td class="s">$prg_select-&gt;execute();<div class="calls"><div class="calls_out"># spent   119&micro;s making 1 call to <a >DBI::st::execute</a></div></div></td></tr>
<tr><td class="h"><a name="263"></a>263</td><td class="c3">1</td><td class="c0"><span title="Avg 78&micro;s">78&micro;s</span></td><td class="c0">57</td><td class="c0">474&micro;s</td><td class="s">while (my $ref = $prg_select-&gt;fetchrow_hashref()) {<div class="calls"><div class="calls_out"># spent   336&micro;s making 19 calls to <a >DBI::st::fetchrow_hashref</a>, avg 18&micro;s/call
# spent    74&micro;s making 19 calls to <a >DBI::common::FETCH</a>, avg 4&micro;s/call
# spent    64&micro;s making 19 calls to <a >DBI::st::fetch</a>, avg 3&micro;s/call</div></div></td></tr>
<tr><td class="h"><a name="264"></a>264</td><td></td><td></td><td></td><td></td><td class="s">    $program_cache{$ref-&gt;{'name'}} = $ref-&gt;{'crc'};</td></tr>
<tr><td class="h"><a name="265"></a>265</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h"><a name="266"></a>266</td><td class="c3">1</td><td class="c0"><span title="Avg 359&micro;s">359&micro;s</span></td><td class="c3">1</td><td class="c3">40&micro;s</td><td class="s">my $host_select = $dbh-&gt;prepare(&quot;SELECT * FROM hosts&quot;);<div class="calls"><div class="calls_out"># spent    40&micro;s making 1 call to <a >DBI::db::prepare</a></div></div></td></tr>
<tr><td class="h"><a name="267"></a>267</td><td class="c3">1</td><td class="c0"><span title="Avg 394&micro;s">394&micro;s</span></td><td class="c3">1</td><td class="c0">386&micro;s</td><td class="s">$host_select-&gt;execute();<div class="calls"><div class="calls_out"># spent   386&micro;s making 1 call to <a >DBI::st::execute</a></div></div></td></tr>
<tr><td class="h"><a name="268"></a>268</td><td class="c3">1</td><td class="c1"><span title="Avg 36&micro;s">36&micro;s</span></td><td class="c0">4131</td><td class="c0">27.2ms</td><td class="s">while (my $ref = $host_select-&gt;fetchrow_hashref()) {<div class="calls"><div class="calls_out"># spent  19.5ms making 1377 calls to <a >DBI::st::fetchrow_hashref</a>, avg 14&micro;s/call
# spent  3.95ms making 1377 calls to <a >DBI::st::fetch</a>, avg 3&micro;s/call
# spent  3.75ms making 1377 calls to <a >DBI::common::FETCH</a>, avg 3&micro;s/call</div></div></td></tr>
<tr><td class="h"><a name="269"></a>269</td><td></td><td></td><td></td><td></td><td class="s">    $host_cache{$ref-&gt;{'host'}} = $ref-&gt;{'host'};</td></tr>
<tr><td class="h"><a name="270"></a>270</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h"><a name="271"></a>271</td><td class="c3">1</td><td class="c0"><span title="Avg 24.7ms">24.7ms</span></td><td class="c3">1</td><td class="c3">44&micro;s</td><td class="s">my $mne_select = $dbh-&gt;prepare(&quot;SELECT * FROM mne&quot;);<div class="calls"><div class="calls_out"># spent    44&micro;s making 1 call to <a >DBI::db::prepare</a></div></div></td></tr>
<tr><td class="h"><a name="272"></a>272</td><td class="c3">1</td><td class="c0"><span title="Avg 160&micro;s">160&micro;s</span></td><td class="c3">1</td><td class="c0">153&micro;s</td><td class="s">$mne_select-&gt;execute();<div class="calls"><div class="calls_out"># spent   153&micro;s making 1 call to <a >DBI::st::execute</a></div></div></td></tr>
<tr><td class="h"><a name="273"></a>273</td><td class="c3">1</td><td class="c1"><span title="Avg 37&micro;s">37&micro;s</span></td><td class="c0">246</td><td class="c0">1.67ms</td><td class="s">while (my $ref = $mne_select-&gt;fetchrow_hashref()) {<div class="calls"><div class="calls_out"># spent  1.20ms making 82 calls to <a >DBI::st::fetchrow_hashref</a>, avg 15&micro;s/call
# spent   243&micro;s making 82 calls to <a >DBI::st::fetch</a>, avg 3&micro;s/call
# spent   227&micro;s making 82 calls to <a >DBI::common::FETCH</a>, avg 3&micro;s/call</div></div></td></tr>
<tr><td class="h"><a name="274"></a>274</td><td></td><td></td><td></td><td></td><td class="s">    $mne_cache{$ref-&gt;{'name'}} = $ref-&gt;{'crc'};</td></tr>
<tr><td class="h"><a name="275"></a>275</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h"><a name="276"></a>276</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="277"></a>277</td><td></td><td></td><td></td><td></td><td class="s">my $session = POE::Session-&gt;create(</td></tr>
<tr><td class="h"><a name="278"></a>278</td><td></td><td></td><td></td><td></td><td class="s">    inline_states =&gt; {</td></tr>
<tr><td class="h"><a name="279"></a>279</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="280"></a>280</td><td></td><td></td><td></td><td></td><td class="s"><div class="calls"><div class="calls_in"># spent 1.19ms (12&micro;s+1.18) within main::__ANON__[/www/svn/logzilla/scripts/db_inse.pl:290] which was called
#    once (12&micro;s+1.18ms) by POE::Session::_invoke_state at <a href="POE-Session-pm-block.html#463">line 463 of POE/Session.pm</a></div></div>        _start =&gt; sub {</td></tr>
<tr><td class="h"><a name="281"></a>281</td><td class="c0">3</td><td class="c3"><span title="Avg 4&micro;s">14&micro;s</span></td><td></td><td></td><td class="s">            my ($heap, $session) = @_[ HEAP, SESSION ];</td></tr>
<tr><td class="h"><a name="282"></a>282</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="283"></a>283</td><td></td><td></td><td></td><td></td><td class="s">            $alog-&gt;debug(&quot;Starting parent session &quot;.$session-&gt;ID.&quot;\n&quot;)                if ($debug &gt;= 1);</td></tr>
<tr><td class="h"><a name="284"></a>284</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="285"></a>285</td><td></td><td></td><td></td><td></td><td class="s">            $heap-&gt;{tail} = POE::Wheel::FollowTail-&gt;new(<div class="calls"><div class="calls_out">            # spent  1.18ms making 1 call to <a href="POE-Wheel-FollowTail-pm-block.html#56">POE::Wheel::FollowTail::new</a></div></div></td></tr>
<tr><td class="h"><a name="286"></a>286</td><td></td><td></td><td></td><td></td><td class="s">                Filename =&gt; $input_stream,</td></tr>
<tr><td class="h"><a name="287"></a>287</td><td></td><td></td><td></td><td></td><td class="s">                PollInterval =&gt; 1,</td></tr>
<tr><td class="h"><a name="288"></a>288</td><td></td><td></td><td></td><td></td><td class="s">                InputEvent =&gt; &quot;input_event&quot;,</td></tr>
<tr><td class="h"><a name="289"></a>289</td><td></td><td></td><td></td><td></td><td class="s">            );</td></tr>
<tr><td class="h"><a name="290"></a>290</td><td></td><td></td><td></td><td></td><td class="s">        },</td></tr>
<tr><td class="h"><a name="291"></a>291</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="292"></a>292</td><td></td><td></td><td></td><td></td><td class="s"><div class="calls"><div class="calls_in"># spent 13.2s (346ms+12.8) within main::__ANON__[/www/svn/logzilla/scripts/db_inse.pl:298] which was called 68267 times, avg 193&micro;s/call:
# 68267 times (346ms+12.8s) by POE::Session::_invoke_state at <a href="POE-Session-pm-block.html#463">line 463 of POE/Session.pm</a>, avg 193&micro;s/call</div></div>        input_event =&gt; sub {</td></tr>
<tr><td class="h"><a name="293"></a>293</td><td class="c0">136534</td><td class="c0"><span title="Avg 2&micro;s">332ms</span></td><td></td><td></td><td class="s">            my ($kernel, $heap, $input) = @_[ KERNEL, HEAP, ARG0 ];</td></tr>
<tr><td class="h"><a name="294"></a>294</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="295"></a>295</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="296"></a>296</td><td></td><td></td><td></td><td></td><td class="s">counter($input);<div class="calls"><div class="calls_out"># spent  12.8s making 68267 calls to <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#310">main::counter</a>, avg 188&micro;s/call</div></div></td></tr>
<tr><td class="h"><a name="297"></a>297</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="298"></a>298</td><td></td><td></td><td></td><td></td><td class="s">    },</td></tr>
<tr><td class="h"><a name="299"></a>299</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="300"></a>300</td><td></td><td></td><td></td><td></td><td class="s">        do_action =&gt; sub {</td></tr>
<tr><td class="h"><a name="301"></a>301</td><td></td><td></td><td></td><td></td><td class="s">            print &quot;I am doing some action!\n&quot; if $debug;</td></tr>
<tr><td class="h"><a name="302"></a>302</td><td></td><td></td><td></td><td></td><td class="s">        },</td></tr>
<tr><td class="h"><a name="303"></a>303</td><td></td><td></td><td></td><td></td><td class="s">    },</td></tr>
<tr><td class="h"><a name="304"></a>304</td><td class="c3">1</td><td class="c0"><span title="Avg 1.50ms">1.50ms</span></td><td class="c3">1</td><td class="c0">1.53ms</td><td class="s">);<div class="calls"><div class="calls_out"># spent  1.53ms making 1 call to <a href="POE-Session-pm-block.html#209">POE::Session::create</a></div></div></td></tr>
<tr><td class="h"><a name="305"></a>305</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="306"></a>306</td><td class="c3">1</td><td class="c3"><span title="Avg 3&micro;s">3&micro;s</span></td><td class="c3">1</td><td class="c0">357s</td><td class="s">$poe_kernel-&gt;run();<div class="calls"><div class="calls_out"># spent   357s making 1 call to <a href="POE-Kernel-pm-block.html#1255">POE::Kernel::run</a></div></div></td></tr>
<tr><td class="h"><a name="307"></a>307</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="308"></a>308</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="309"></a>309</td><td></td><td></td><td></td><td></td><td class="s">#while (my $msg = &lt;STDIN&gt;) {</td></tr>
<tr><td class="h"><a name="310"></a>310</td><td></td><td></td><td></td><td></td><td class="s"><div class="calls"><div class="calls_in"># spent 12.8s (2.35+10.5) within main::counter which was called 68267 times, avg 188&micro;s/call:
# 68267 times (2.35s+10.5s) by main::__ANON__[/www/svn/logzilla/scripts/db_inse.pl:298] at <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#296">line 296</a>, avg 188&micro;s/call</div></div>sub counter  {</td></tr>
<tr><td class="h"><a name="311"></a>311</td><td class="c0">1160536</td><td class="c0"><span title="Avg 2&micro;s">1.83s</span></td><td></td><td></td><td class="s">        my $msg = shift;</td></tr>
<tr><td class="h"><a name="312"></a>312</td><td></td><td></td><td></td><td></td><td class="s">        my $stamp = localtime;</td></tr>
<tr><td class="h"><a name="313"></a>313</td><td></td><td></td><td></td><td></td><td class="s">        my $lnow = yyyymmddhhmmss(1,1,1,0,0,0,$stamp);<div class="calls"><div class="calls_out">        # spent   940ms making 68267 calls to <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#464">main::yyyymmddhhmmss</a>, avg 14&micro;s/call</div></div></td></tr>
<tr><td class="h"><a name="314"></a>314</td><td></td><td></td><td></td><td></td><td class="s">        my $dnow = yyyymmddhhmmss(0,0,0,1,1,1,$stamp);<div class="calls"><div class="calls_out">        # spent   540ms making 68267 calls to <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#464">main::yyyymmddhhmmss</a>, avg 8&micro;s/call</div></div></td></tr>
<tr><td class="h"><a name="315"></a>315</td><td></td><td></td><td></td><td></td><td class="s">    my $now = $lnow;</td></tr>
<tr><td class="h"><a name="316"></a>316</td><td></td><td></td><td></td><td></td><td class="s">        $now .= $dnow;</td></tr>
<tr><td class="h"><a name="317"></a>317</td><td></td><td></td><td></td><td></td><td class="s">    $blog-&gt;info (&quot;\n\n-=-=-=-=-=-=-=\nLOOP START: $now\n&quot;) if ($debug &gt; 10);</td></tr>
<tr><td class="h"><a name="318"></a>318</td><td></td><td></td><td></td><td></td><td class="s">    #$dbh-&gt;{InactiveDestroy} = 1;</td></tr>
<tr><td class="h"><a name="319"></a>319</td><td></td><td></td><td></td><td></td><td class="s">    #my $pid = $$;</td></tr>
<tr><td class="h"><a name="320"></a>320</td><td></td><td></td><td></td><td></td><td class="s">    #fork and exit;</td></tr>
<tr><td class="h"><a name="321"></a>321</td><td></td><td></td><td></td><td></td><td class="s">    #my $p = $$;</td></tr>
<tr><td class="h"><a name="322"></a>322</td><td></td><td></td><td></td><td></td><td class="s">    #print LOG &quot;DEBUG: Forked\nDEBUG: Old pid = $pid\nDEBUG: New PID = $p\n&quot; if ($debug &gt; 10);</td></tr>
<tr><td class="h"><a name="323"></a>323</td><td></td><td></td><td></td><td></td><td class="s">    if ($qsize) {</td></tr>
<tr><td class="h"><a name="324"></a>324</td><td></td><td></td><td></td><td></td><td class="s">        for (my $i=0; $i &lt;= 5; $i++) {</td></tr>
<tr><td class="h"><a name="325"></a>325</td><td></td><td></td><td></td><td></td><td class="s">            push (@dumparr, &quot;fakehost\tlocal7\temerg\tdbins_tag\tdb_insert.pl\tdb_insert.pl[$$]: %SYS-5-CONFIG_I: Configured from 172.16.0.123 by Fred Flinstone &lt;fred\@flinstone.com&gt;\tSYS-5-CONFIG_I\t$datetime\t$datetime\t\n&quot;);</td></tr>
<tr><td class="h"><a name="326"></a>326</td><td></td><td></td><td></td><td></td><td class="s">        }</td></tr>
<tr><td class="h"><a name="327"></a>327</td><td></td><td></td><td></td><td></td><td class="s">    }</td></tr>
<tr><td class="h"><a name="328"></a>328</td><td></td><td></td><td></td><td></td><td class="s">    $mps++;</td></tr>
<tr><td class="h"><a name="329"></a>329</td><td class="c0">340789</td><td class="c0"><span title="Avg 628ns">214ms</span></td><td></td><td></td><td class="s">    if (($#dumparr &lt; $q_limit) &amp;&amp; ($start_time &lt;= $time_limit)) {</td></tr>
<tr><td class="h"><a name="330"></a>330</td><td></td><td></td><td></td><td></td><td class="s">        push(@dumparr, do_msg($msg));<div class="calls"><div class="calls_out">        # spent  5.45s making 68085 calls to <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#533">main::do_msg</a>, avg 80&micro;s/call</div></div></td></tr>
<tr><td class="h"><a name="331"></a>331</td><td></td><td></td><td></td><td></td><td class="s">$blog-&gt;info (&quot;DEBUG: Pushing message into the array because either the size of the dumparr is &lt; Q_limit or the start time &lt;= time limit\n&quot;) if ($debug &gt; 10);</td></tr>
<tr><td class="h"><a name="332"></a>332</td><td></td><td></td><td></td><td></td><td class="s">$blog-&gt;info(&quot;DEBUG: Dump array size = &quot;.$#dumparr.&quot;\nDEBUG: Q Limit set to &quot;.$q_limit.&quot;\nDEBUG: Start Time was &quot;.$start_time.&quot;\n&quot; . &quot;DEBUG: Time Limit set to &quot;.$time_limit.&quot;\n&quot;) if ($debug &gt; 10);</td></tr>
<tr><td class="h"><a name="333"></a>333</td><td></td><td></td><td></td><td></td><td class="s">        #push (@dumparr, &quot;host\tfacility\tseverity\ttag\tprg\tmsg\tmne\t$datetime_now\t$datetime_now\t\n&quot;);</td></tr>
<tr><td class="h"><a name="334"></a>334</td><td></td><td></td><td></td><td></td><td class="s">        $start_time = time;</td></tr>
<tr><td class="h"><a name="335"></a>335</td><td></td><td></td><td></td><td></td><td class="s">        $blog-&gt;info(&quot;DEBUG: *NEW* Start Time is &quot;.$start_time.&quot;\n&quot;) if ($debug &gt; 10);</td></tr>
<tr><td class="h"><a name="336"></a>336</td><td></td><td></td><td></td><td></td><td class="s">    } else { </td></tr>
<tr><td class="h"><a name="337"></a>337</td><td></td><td></td><td></td><td></td><td class="s">        $blog-&gt;info(&quot;DEBUG: Limit reached, processing queue\n&quot;) if ($debug &gt; 10);</td></tr>
<tr><td class="h"><a name="338"></a>338</td><td class="c0">2548</td><td class="c0"><span title="Avg 292&micro;s">744ms</span></td><td></td><td></td><td class="s">        if ($#dumparr &gt;= 0 ) {</td></tr>
<tr><td class="h"><a name="339"></a>339</td><td class="c0">364</td><td class="c0"><span title="Avg 391ns">142&micro;s</span></td><td></td><td></td><td class="s">            if ($start_time &gt;= $time_limit) {</td></tr>
<tr><td class="h"><a name="340"></a>340</td><td></td><td></td><td></td><td></td><td class="s">                $alog-&gt;debug(&quot;\n\nQueue time limit reached ($q_time seconds)\n&quot;) if ($debug &gt; 0) ;</td></tr>
<tr><td class="h"><a name="341"></a>341</td><td></td><td></td><td></td><td></td><td class="s">                $blog-&gt;info(&quot;\n\nQueue time limit reached ($q_time seconds)\n&quot;) if ($debug &gt; 0);</td></tr>
<tr><td class="h"><a name="342"></a>342</td><td></td><td></td><td></td><td></td><td class="s">            } else {</td></tr>
<tr><td class="h"><a name="343"></a>343</td><td></td><td></td><td></td><td></td><td class="s">                my $t = ($end_time - $start_time);</td></tr>
<tr><td class="h"><a name="344"></a>344</td><td></td><td></td><td></td><td></td><td class="s">                if ($t &gt; 0) {</td></tr>
<tr><td class="h"><a name="345"></a>345</td><td></td><td></td><td></td><td></td><td class="s">                    $tmp_mps = round($q_limit / $t);</td></tr>
<tr><td class="h"><a name="346"></a>346</td><td></td><td></td><td></td><td></td><td class="s">                } else {</td></tr>
<tr><td class="h"><a name="347"></a>347</td><td></td><td></td><td></td><td></td><td class="s">                    $tmp_mps = round($q_limit / 1);</td></tr>
<tr><td class="h"><a name="348"></a>348</td><td></td><td></td><td></td><td></td><td class="s">                }</td></tr>
<tr><td class="h"><a name="349"></a>349</td><td></td><td></td><td></td><td></td><td class="s">                $blog-&gt;info(&quot;\n\nQueue Limit Reached: $q_limit messages in $t seconds ($tmp_mps MPS)\n&quot;) if ($debug &gt; 0);</td></tr>
<tr><td class="h"><a name="350"></a>350</td><td></td><td></td><td></td><td></td><td class="s">                $alog-&gt;debug(&quot;\n\nQueue Limit Reached: $q_limit messages in $t seconds ($tmp_mps MPS)\n&quot;) if ($debug &gt; 0);</td></tr>
<tr><td class="h"><a name="351"></a>351</td><td></td><td></td><td></td><td></td><td class="s">            }</td></tr>
<tr><td class="h"><a name="352"></a>352</td><td></td><td></td><td></td><td></td><td class="s">            foreach my $var (@mps) {</td></tr>
<tr><td class="h"><a name="353"></a>353</td><td class="c0">16470</td><td class="c0"><span title="Avg 87&micro;s">1.43s</span></td><td class="c0">5490</td><td class="c0">32.3ms</td><td class="s">                if ($var =~ /(.*),(.*),(.*)/) {<div class="calls"><div class="calls_out">                # spent  32.3ms making 5490 calls to <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#main__CORE_match">main::CORE:match</a>, avg 6&micro;s/call</div></div></td></tr>
<tr><td class="h"><a name="354"></a>354</td><td></td><td></td><td></td><td></td><td class="s">                    $db_insert_mpX-&gt;execute(&quot;$1&quot;, &quot;$2&quot;, &quot;$3&quot;);<div class="calls"><div class="calls_out">                    # spent  1.33s making 5490 calls to <a >DBI::st::execute</a>, avg 242&micro;s/call</div></div></td></tr>
<tr><td class="h"><a name="355"></a>355</td><td></td><td></td><td></td><td></td><td class="s">                    $alog-&gt;debug(&quot;Inserting MPS string: $1, $2, $3\n&quot;) if ($debug &gt; 1);</td></tr>
<tr><td class="h"><a name="356"></a>356</td><td></td><td></td><td></td><td></td><td class="s">                }</td></tr>
<tr><td class="h"><a name="357"></a>357</td><td></td><td></td><td></td><td></td><td class="s">            }</td></tr>
<tr><td class="h"><a name="358"></a>358</td><td></td><td></td><td></td><td></td><td class="s">            open (DUMP, &quot;&gt;$dumpfile&quot;) or die &quot;can't open $dumpfile: $!\n&quot;;<div class="calls"><div class="calls_out">            # spent  7.74ms making 182 calls to <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#main__CORE_open">main::CORE:open</a>, avg 43&micro;s/call</div></div></td></tr>
<tr><td class="h"><a name="359"></a>359</td><td></td><td></td><td></td><td></td><td class="s">            $blog-&gt;info(&quot;Starting insert: &quot; . yyyymmddhhmmss(0,0,0,1,1,1,localtime) .&quot;\n&quot;) if ($debug &gt; 0);</td></tr>
<tr><td class="h"><a name="360"></a>360</td><td></td><td></td><td></td><td></td><td class="s">            $alog-&gt;debug(&quot;Starting insert: &quot; . yyyymmddhhmmss(0,0,0,1,1,1,localtime) . &quot;\nImporting $#dumparr messages into the database\n&quot;) if ($debug &gt; 0);</td></tr>
<tr><td class="h"><a name="361"></a>361</td><td></td><td></td><td></td><td></td><td class="s">            $blog-&gt;info( &quot;Importing $#dumparr messages into the database\n&quot;) if ($debug &gt; 0);</td></tr>
<tr><td class="h"><a name="362"></a>362</td><td></td><td></td><td></td><td></td><td class="s">            print DUMP @dumparr;<div class="calls"><div class="calls_out">            # spent  22.9ms making 182 calls to <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#main__CORE_print">main::CORE:print</a>, avg 126&micro;s/call</div></div></td></tr>
<tr><td class="h"><a name="363"></a>363</td><td></td><td></td><td></td><td></td><td class="s">            close (DUMP);<div class="calls"><div class="calls_out">            # spent  1.67ms making 182 calls to <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#main__CORE_close">main::CORE:close</a>, avg 9&micro;s/call</div></div></td></tr>
<tr><td class="h"><a name="364"></a>364</td><td></td><td></td><td></td><td></td><td class="s">            $db_load-&gt;execute();<div class="calls"><div class="calls_out">            # spent   695ms making 182 calls to <a >DBI::st::execute</a>, avg 3.82ms/call</div></div></td></tr>
<tr><td class="h"><a name="365"></a>365</td><td></td><td></td><td></td><td></td><td class="s">            if ($db_load-&gt;errstr()) {<div class="calls"><div class="calls_out">            # spent  1.29ms making 182 calls to <a >DBI::common::errstr</a>, avg 7&micro;s/call</div></div></td></tr>
<tr><td class="h"><a name="366"></a>366</td><td></td><td></td><td></td><td></td><td class="s">                $alog-&gt;debug(&quot;FATAL: Unable to execute SQL statement: &quot;, $db_load-&gt;errstr(), &quot;\n&quot;) if ($debug &gt; 0);</td></tr>
<tr><td class="h"><a name="367"></a>367</td><td></td><td></td><td></td><td></td><td class="s">            }</td></tr>
<tr><td class="h"><a name="368"></a>368</td><td></td><td></td><td></td><td></td><td class="s">            $blog-&gt;info( &quot;Ending insert: &quot; . yyyymmddhhmmss(0,0,0,1,1,1,localtime) .&quot;\n&quot;) if ($debug &gt; 0);</td></tr>
<tr><td class="h"><a name="369"></a>369</td><td></td><td></td><td></td><td></td><td class="s">            $alog-&gt;debug(&quot;Ending insert: &quot; . yyyymmddhhmmss(0,0,0,1,1,1,localtime) .&quot;\n&quot;) if (($debug &gt; 0) and ($verbose));</td></tr>
<tr><td class="h"><a name="370"></a>370</td><td></td><td></td><td></td><td></td><td class="s">            @dumparr = ();</td></tr>
<tr><td class="h"><a name="371"></a>371</td><td></td><td></td><td></td><td></td><td class="s">            #$start_time = (time);</td></tr>
<tr><td class="h"><a name="372"></a>372</td><td></td><td></td><td></td><td></td><td class="s">            $time_limit = ($start_time + $q_time);</td></tr>
<tr><td class="h"><a name="373"></a>373</td><td></td><td></td><td></td><td></td><td class="s">        } else {</td></tr>
<tr><td class="h"><a name="374"></a>374</td><td></td><td></td><td></td><td></td><td class="s">            push(@dumparr, do_msg($msg));</td></tr>
<tr><td class="h"><a name="375"></a>375</td><td></td><td></td><td></td><td></td><td class="s">$blog-&gt;info(&quot;DEBUG: SHOULD NOT HIT THIS\nDEBUG:Dump array size = &quot;.$#dumparr.&quot;\nDEBUG: Contents = &quot; . @dumparr .&quot;\nDEBUG: Current Message is $msg\n&quot; . @dumparr ) if ($debug &gt; 10);</td></tr>
<tr><td class="h"><a name="376"></a>376</td><td></td><td></td><td></td><td></td><td class="s">        }</td></tr>
<tr><td class="h"><a name="377"></a>377</td><td></td><td></td><td></td><td></td><td class="s">    }</td></tr>
<tr><td class="h"><a name="378"></a>378</td><td></td><td></td><td></td><td></td><td class="s">    my $mps_timer_end = (time);</td></tr>
<tr><td class="h"><a name="379"></a>379</td><td></td><td></td><td></td><td></td><td class="s">    my $tmp_time = localtime;</td></tr>
<tr><td class="h"><a name="380"></a>380</td><td></td><td></td><td></td><td></td><td class="s">    my $secs = ($mps_timer_end - $mps_timer_start);</td></tr>
<tr><td class="h"><a name="381"></a>381</td><td class="c0">8047</td><td class="c0"><span title="Avg 19&micro;s">156ms</span></td><td></td><td></td><td class="s">    if ($secs &gt; 0) {</td></tr>
<tr><td class="h"><a name="382"></a>382</td><td></td><td></td><td></td><td></td><td class="s">        $mps = $mps + $do_msg_mps;</td></tr>
<tr><td class="h"><a name="383"></a>383</td><td></td><td></td><td></td><td></td><td class="s">        $mps = ($mps/$secs);</td></tr>
<tr><td class="h"><a name="384"></a>384</td><td></td><td></td><td></td><td></td><td class="s">        if ($mps &lt; 1) {</td></tr>
<tr><td class="h"><a name="385"></a>385</td><td></td><td></td><td></td><td></td><td class="s">            $mps = ($mps * $secs);</td></tr>
<tr><td class="h"><a name="386"></a>386</td><td></td><td></td><td></td><td></td><td class="s">        }</td></tr>
<tr><td class="h"><a name="387"></a>387</td><td></td><td></td><td></td><td></td><td class="s">                $now = yyyymmddhhmmss(1,1,1,1,1,1,$tmp_time);<div class="calls"><div class="calls_out">                # spent  5.94ms making 366 calls to <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#464">main::yyyymmddhhmmss</a>, avg 16&micro;s/call</div></div></td></tr>
<tr><td class="h"><a name="388"></a>388</td><td></td><td></td><td></td><td></td><td class="s">                $day = yyyymmddhhmmss(0,0,1,0,0,0,$tmp_time);<div class="calls"><div class="calls_out">                # spent  2.08ms making 366 calls to <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#464">main::yyyymmddhhmmss</a>, avg 6&micro;s/call</div></div></td></tr>
<tr><td class="h"><a name="389"></a>389</td><td></td><td></td><td></td><td></td><td class="s">                $hr = yyyymmddhhmmss(0,0,0,1,0,0,$tmp_time);<div class="calls"><div class="calls_out">                # spent  1.84ms making 366 calls to <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#464">main::yyyymmddhhmmss</a>, avg 5&micro;s/call</div></div></td></tr>
<tr><td class="h"><a name="390"></a>390</td><td></td><td></td><td></td><td></td><td class="s">                $min= yyyymmddhhmmss(0,0,0,0,1,0,$tmp_time);<div class="calls"><div class="calls_out">                # spent  1.80ms making 366 calls to <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#464">main::yyyymmddhhmmss</a>, avg 5&micro;s/call</div></div></td></tr>
<tr><td class="h"><a name="391"></a>391</td><td></td><td></td><td></td><td></td><td class="s">                $sec= yyyymmddhhmmss(0,0,0,0,0,1,$tmp_time);<div class="calls"><div class="calls_out">                # spent  1.83ms making 366 calls to <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#464">main::yyyymmddhhmmss</a>, avg 5&micro;s/call</div></div></td></tr>
<tr><td class="h"><a name="392"></a>392</td><td></td><td></td><td></td><td></td><td class="s">        #print STDOUT &quot;min = $min\n&quot;;</td></tr>
<tr><td class="h"><a name="393"></a>393</td><td></td><td></td><td></td><td></td><td class="s">        $mps = round($mps);<div class="calls"><div class="calls_out">        # spent  1.20ms making 366 calls to <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#516">main::round</a>, avg 3&micro;s/call</div></div></td></tr>
<tr><td class="h"><a name="394"></a>394</td><td></td><td></td><td></td><td></td><td class="s">        $alog-&gt;debug(&quot;\n#######\nCurrent MPS = $mps ($do_msg_mps deduplicated)\n#######\n&quot;) if ($debug &gt; 2);</td></tr>
<tr><td class="h"><a name="395"></a>395</td><td></td><td></td><td></td><td></td><td class="s">        $blog-&gt;info( &quot;\n#######\nCurrent MPS = $mps ($do_msg_mps deduplicated)\n#######\n&quot;) if ($debug &gt; 2);</td></tr>
<tr><td class="h"><a name="396"></a>396</td><td></td><td></td><td></td><td></td><td class="s">        $mpm += $mps;</td></tr>
<tr><td class="h"><a name="397"></a>397</td><td></td><td></td><td></td><td></td><td class="s">        push(@mps, &quot;chart_mps_$sec,$mps,$now&quot;);</td></tr>
<tr><td class="h"><a name="398"></a>398</td><td></td><td></td><td></td><td></td><td class="s">        $db_insert_sum-&gt;{TraceLevel} = 4 if ($debug &gt; 4);</td></tr>
<tr><td class="h"><a name="399"></a>399</td><td></td><td></td><td></td><td></td><td class="s">        $db_insert_sum-&gt;execute($mps, $now, $mps);<div class="calls"><div class="calls_out">        # spent   143ms making 366 calls to <a >DBI::st::execute</a>, avg 392&micro;s/call</div></div></td></tr>
<tr><td class="h"><a name="400"></a>400</td><td class="c0">108</td><td class="c0"><span title="Avg 57&micro;s">6.15ms</span></td><td></td><td></td><td class="s">        if ($#mps == 60) {</td></tr>
<tr><td class="h"><a name="401"></a>401</td><td></td><td></td><td></td><td></td><td class="s">            my $now = yyyymmddhhmmss(1,1,1,1,1,1,localtime);<div class="calls"><div class="calls_out">            # spent   105&micro;s making 6 calls to <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#464">main::yyyymmddhhmmss</a>, avg 17&micro;s/call</div></div></td></tr>
<tr><td class="h"><a name="402"></a>402</td><td></td><td></td><td></td><td></td><td class="s">            push(@mpm, &quot;chart_mpm_$min,$mpm,$now&quot;);</td></tr>
<tr><td class="h"><a name="403"></a>403</td><td></td><td></td><td></td><td></td><td class="s">            $db_insert_mpX-&gt;{TraceLevel} = 4 if (($debug &gt; 4) and ($verbose));</td></tr>
<tr><td class="h"><a name="404"></a>404</td><td></td><td></td><td></td><td></td><td class="s">            $db_insert_mpX-&gt;execute(&quot;chart_mpm_$min&quot;, &quot;$mpm&quot;, &quot;$now&quot;);<div class="calls"><div class="calls_out">            # spent  1.23ms making 6 calls to <a >DBI::st::execute</a>, avg 205&micro;s/call</div></div></td></tr>
<tr><td class="h"><a name="405"></a>405</td><td></td><td></td><td></td><td></td><td class="s">            $alog-&gt;debug(&quot;Messages Per Minute = $mpm\n&quot;) if ($debug &gt; 1);</td></tr>
<tr><td class="h"><a name="406"></a>406</td><td></td><td></td><td></td><td></td><td class="s">            $blog-&gt;info( &quot;Messages Per Minute = $mpm\n&quot;) if ($debug &gt; 1);</td></tr>
<tr><td class="h"><a name="407"></a>407</td><td></td><td></td><td></td><td></td><td class="s">            $mph += $mpm;</td></tr>
<tr><td class="h"><a name="408"></a>408</td><td></td><td></td><td></td><td></td><td class="s">            $mpm = 0;</td></tr>
<tr><td class="h"><a name="409"></a>409</td><td></td><td></td><td></td><td></td><td class="s">            @mps = ();</td></tr>
<tr><td class="h"><a name="410"></a>410</td><td></td><td></td><td></td><td></td><td class="s">            my @hosts = keys %host_cache;</td></tr>
<tr><td class="h"><a name="411"></a>411</td><td></td><td></td><td></td><td></td><td class="s">            foreach my $h (@hosts) {</td></tr>
<tr><td class="h"><a name="412"></a>412</td><td class="c0">5596</td><td class="c0"><span title="Avg 141&micro;s">788ms</span></td><td class="c0">5596</td><td class="c0">755ms</td><td class="s">                $db_insert_host-&gt;execute($h);<div class="calls"><div class="calls_out">                # spent   755ms making 5596 calls to <a >DBI::st::execute</a>, avg 135&micro;s/call</div></div></td></tr>
<tr><td class="h"><a name="413"></a>413</td><td></td><td></td><td></td><td></td><td class="s">            }</td></tr>
<tr><td class="h"><a name="414"></a>414</td><td></td><td></td><td></td><td></td><td class="s">            my @prgs = keys %program_cache;</td></tr>
<tr><td class="h"><a name="415"></a>415</td><td></td><td></td><td></td><td></td><td class="s">            foreach my $p (@prgs) {</td></tr>
<tr><td class="h"><a name="416"></a>416</td><td class="c0">33</td><td class="c0"><span title="Avg 141&micro;s">4.67ms</span></td><td class="c0">33</td><td class="c0">4.45ms</td><td class="s">                $db_insert_prg-&gt;execute($p, $program_cache{$p});<div class="calls"><div class="calls_out">                # spent  4.45ms making 33 calls to <a >DBI::st::execute</a>, avg 135&micro;s/call</div></div></td></tr>
<tr><td class="h"><a name="417"></a>417</td><td></td><td></td><td></td><td></td><td class="s">            }</td></tr>
<tr><td class="h"><a name="418"></a>418</td><td></td><td></td><td></td><td></td><td class="s">            my @mnes = keys %mne_cache;</td></tr>
<tr><td class="h"><a name="419"></a>419</td><td></td><td></td><td></td><td></td><td class="s">            foreach my $m (@mnes) {</td></tr>
<tr><td class="h"><a name="420"></a>420</td><td class="c0">458</td><td class="c0"><span title="Avg 136&micro;s">62.4ms</span></td><td class="c0">458</td><td class="c0">59.5ms</td><td class="s">                $db_insert_mne-&gt;execute($m, $mne_cache{$m});<div class="calls"><div class="calls_out">                # spent  59.5ms making 458 calls to <a >DBI::st::execute</a>, avg 130&micro;s/call</div></div></td></tr>
<tr><td class="h"><a name="421"></a>421</td><td></td><td></td><td></td><td></td><td class="s">            }</td></tr>
<tr><td class="h"><a name="422"></a>422</td><td></td><td></td><td></td><td></td><td class="s">            %host_cache = ();</td></tr>
<tr><td class="h"><a name="423"></a>423</td><td></td><td></td><td></td><td></td><td class="s">            %program_cache = ();</td></tr>
<tr><td class="h"><a name="424"></a>424</td><td></td><td></td><td></td><td></td><td class="s">            %mne_cache = ();</td></tr>
<tr><td class="h"><a name="425"></a>425</td><td></td><td></td><td></td><td></td><td class="s">        }</td></tr>
<tr><td class="h"><a name="426"></a>426</td><td></td><td></td><td></td><td></td><td class="s">        # Temp: exit after 5 minutes for testing</td></tr>
<tr><td class="h"><a name="427"></a>427</td><td class="c3">1</td><td class="c0"><span title="Avg 227&micro;s">227&micro;s</span></td><td></td><td></td><td class="s">        if ($#mpm == 5) {</td></tr>
<tr><td class="h"><a name="428"></a>428</td><td></td><td></td><td></td><td></td><td class="s">            #print STDOUT &quot;Test Exit\n&quot;;</td></tr>
<tr><td class="h"><a name="429"></a>429</td><td></td><td></td><td></td><td></td><td class="s">            exit;</td></tr>
<tr><td class="h"><a name="430"></a>430</td><td></td><td></td><td></td><td></td><td class="s">        }</td></tr>
<tr><td class="h"><a name="431"></a>431</td><td></td><td></td><td></td><td></td><td class="s">        if ($#mpm == 60) {</td></tr>
<tr><td class="h"><a name="432"></a>432</td><td></td><td></td><td></td><td></td><td class="s">            push(@mph, &quot;chart_mph_$hr,$mph,$now&quot;);</td></tr>
<tr><td class="h"><a name="433"></a>433</td><td></td><td></td><td></td><td></td><td class="s">            $db_insert_mpX-&gt;execute(&quot;chart_mph_$hr&quot;, &quot;$mph&quot;, &quot;$now&quot;);</td></tr>
<tr><td class="h"><a name="434"></a>434</td><td></td><td></td><td></td><td></td><td class="s">            $alog-&gt;debug(&quot;Messages Per Hour = $mph\n&quot;) if ($debug &gt; 1);</td></tr>
<tr><td class="h"><a name="435"></a>435</td><td></td><td></td><td></td><td></td><td class="s">            $blog-&gt;info( &quot;Messages Per Hour = $mph\n&quot;) if ($debug &gt; 1);</td></tr>
<tr><td class="h"><a name="436"></a>436</td><td></td><td></td><td></td><td></td><td class="s">            $mpd += $mph;</td></tr>
<tr><td class="h"><a name="437"></a>437</td><td></td><td></td><td></td><td></td><td class="s">            $mph = 0;</td></tr>
<tr><td class="h"><a name="438"></a>438</td><td></td><td></td><td></td><td></td><td class="s">            @mpm = ();</td></tr>
<tr><td class="h"><a name="439"></a>439</td><td></td><td></td><td></td><td></td><td class="s">        }</td></tr>
<tr><td class="h"><a name="440"></a>440</td><td></td><td></td><td></td><td></td><td class="s">        if ($#mph == 24) {</td></tr>
<tr><td class="h"><a name="441"></a>441</td><td></td><td></td><td></td><td></td><td class="s">            push(@mpd, &quot;chart_mpd_$day,$mpd,$now&quot;);</td></tr>
<tr><td class="h"><a name="442"></a>442</td><td></td><td></td><td></td><td></td><td class="s">            $db_insert_mpX-&gt;execute(&quot;chart_mpd_$day&quot;, &quot;$mpd&quot;, &quot;$now&quot;);</td></tr>
<tr><td class="h"><a name="443"></a>443</td><td></td><td></td><td></td><td></td><td class="s">            $alog-&gt;debug(&quot;Messages Per Day = $mpd\n&quot;) if ($debug &gt; 1);</td></tr>
<tr><td class="h"><a name="444"></a>444</td><td></td><td></td><td></td><td></td><td class="s">            $blog-&gt;info( &quot;Messages Per Day = $mpd\n&quot;) if ($debug &gt; 1);</td></tr>
<tr><td class="h"><a name="445"></a>445</td><td></td><td></td><td></td><td></td><td class="s">            $mpd = 0;</td></tr>
<tr><td class="h"><a name="446"></a>446</td><td></td><td></td><td></td><td></td><td class="s">            @mph = ();</td></tr>
<tr><td class="h"><a name="447"></a>447</td><td></td><td></td><td></td><td></td><td class="s">        }</td></tr>
<tr><td class="h"><a name="448"></a>448</td><td></td><td></td><td></td><td></td><td class="s">        $mps = 0;</td></tr>
<tr><td class="h"><a name="449"></a>449</td><td></td><td></td><td></td><td></td><td class="s">        $do_msg_mps = 0;</td></tr>
<tr><td class="h"><a name="450"></a>450</td><td></td><td></td><td></td><td></td><td class="s">        $mps_timer_start = (time);</td></tr>
<tr><td class="h"><a name="451"></a>451</td><td></td><td></td><td></td><td></td><td class="s">    }</td></tr>
<tr><td class="h"><a name="452"></a>452</td><td></td><td></td><td></td><td></td><td class="s">    $end_time = (time);</td></tr>
<tr><td class="h"><a name="453"></a>453</td><td></td><td></td><td></td><td></td><td class="s">    my $now = yyyymmddhhmmss(0,0,0,0,0,1,$tmp_time); <div class="calls"><div class="calls_out">    # spent   507ms making 68266 calls to <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#464">main::yyyymmddhhmmss</a>, avg 7&micro;s/call</div></div></td></tr>
<tr><td class="h"><a name="454"></a>454</td><td></td><td></td><td></td><td></td><td class="s">    $blog-&gt;info( &quot;LOOP END: $now\n-=-=-=-=-=-=-=-=-=\n&quot;) if ($debug &gt; 10);</td></tr>
<tr><td class="h"><a name="455"></a>455</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h"><a name="456"></a>456</td><td></td><td></td><td></td><td></td><td class="s">#$dbh-&gt;disconnect();</td></tr>
<tr><td class="h"><a name="457"></a>457</td><td></td><td></td><td></td><td></td><td class="s">#close(LOG);</td></tr>
<tr><td class="h"><a name="458"></a>458</td><td></td><td></td><td></td><td></td><td class="s">#exit;</td></tr>
<tr><td class="h"><a name="459"></a>459</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="460"></a>460</td><td></td><td></td><td></td><td></td><td class="s"># Subs</td></tr>
<tr><td class="h"><a name="461"></a>461</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="462"></a>462</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="463"></a>463</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="464"></a>464</td><td></td><td></td><td></td><td></td><td class="s"><div class="calls"><div class="calls_in"># spent 2.00s within main::yyyymmddhhmmss which was called 206636 times, avg 10&micro;s/call:
# 68267 times (940ms+0s) by main::counter at <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#313">line 313</a>, avg 14&micro;s/call
# 68267 times (540ms+0s) by main::counter at <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#314">line 314</a>, avg 8&micro;s/call
# 68266 times (507ms+0s) by main::counter at <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#453">line 453</a>, avg 7&micro;s/call
#   366 times (5.94ms+0s) by main::counter at <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#387">line 387</a>, avg 16&micro;s/call
#   366 times (2.08ms+0s) by main::counter at <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#388">line 388</a>, avg 6&micro;s/call
#   366 times (1.84ms+0s) by main::counter at <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#389">line 389</a>, avg 5&micro;s/call
#   366 times (1.83ms+0s) by main::counter at <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#391">line 391</a>, avg 5&micro;s/call
#   366 times (1.80ms+0s) by main::counter at <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#390">line 390</a>, avg 5&micro;s/call
#     6 times (105&micro;s+0s) by main::counter at <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#401">line 401</a>, avg 17&micro;s/call</div></div>sub yyyymmddhhmmss {</td></tr>
<tr><td class="h"><a name="465"></a>465</td><td class="c0">3099540</td><td class="c0"><span title="Avg 494ns">1.53s</span></td><td></td><td></td><td class="s">    my $yy = shift;</td></tr>
<tr><td class="h"><a name="466"></a>466</td><td></td><td></td><td></td><td></td><td class="s">        my $mm = shift;</td></tr>
<tr><td class="h"><a name="467"></a>467</td><td></td><td></td><td></td><td></td><td class="s">        my $dd = shift;</td></tr>
<tr><td class="h"><a name="468"></a>468</td><td></td><td></td><td></td><td></td><td class="s">        my $hh = shift;</td></tr>
<tr><td class="h"><a name="469"></a>469</td><td></td><td></td><td></td><td></td><td class="s">        my $mmin = shift;</td></tr>
<tr><td class="h"><a name="470"></a>470</td><td></td><td></td><td></td><td></td><td class="s">        my $ss = shift;</td></tr>
<tr><td class="h"><a name="471"></a>471</td><td></td><td></td><td></td><td></td><td class="s">        my @time = @_ ;</td></tr>
<tr><td class="h"><a name="472"></a>472</td><td></td><td></td><td></td><td></td><td class="s">        my $out;</td></tr>
<tr><td class="h"><a name="473"></a>473</td><td class="c0">137278</td><td class="c0"><span title="Avg 2&micro;s">300ms</span></td><td></td><td></td><td class="s">    if($yy){</td></tr>
<tr><td class="h"><a name="474"></a>474</td><td></td><td></td><td></td><td></td><td class="s">        $out .= ($time[5] + 1900) ;</td></tr>
<tr><td class="h"><a name="475"></a>475</td><td></td><td></td><td></td><td></td><td class="s">        if($mm){</td></tr>
<tr><td class="h"><a name="476"></a>476</td><td></td><td></td><td></td><td></td><td class="s">        $out .= '-';</td></tr>
<tr><td class="h"><a name="477"></a>477</td><td></td><td></td><td></td><td></td><td class="s">        }</td></tr>
<tr><td class="h"><a name="478"></a>478</td><td></td><td></td><td></td><td></td><td class="s">        }</td></tr>
<tr><td class="h"><a name="479"></a>479</td><td class="c0">137278</td><td class="c0"><span title="Avg 1&micro;s">157ms</span></td><td></td><td></td><td class="s">        if($mm){</td></tr>
<tr><td class="h"><a name="480"></a>480</td><td></td><td></td><td></td><td></td><td class="s">        $out .=  ((($time[4] + 1) &lt; 10)?(&quot;0&quot; . ($time[4] + 1)):($time[4] + 1));</td></tr>
<tr><td class="h"><a name="481"></a>481</td><td></td><td></td><td></td><td></td><td class="s">        if($dd){</td></tr>
<tr><td class="h"><a name="482"></a>482</td><td></td><td></td><td></td><td></td><td class="s">        $out .=  '-';</td></tr>
<tr><td class="h"><a name="483"></a>483</td><td></td><td></td><td></td><td></td><td class="s">        }</td></tr>
<tr><td class="h"><a name="484"></a>484</td><td></td><td></td><td></td><td></td><td class="s">        }</td></tr>
<tr><td class="h"><a name="485"></a>485</td><td class="c0">138010</td><td class="c0"><span title="Avg 390ns">53.8ms</span></td><td></td><td></td><td class="s">        if($dd){</td></tr>
<tr><td class="h"><a name="486"></a>486</td><td></td><td></td><td></td><td></td><td class="s">        $out .=  (($time[3] &lt; 10)?(&quot;0&quot; . $time[3]):$time[3]);</td></tr>
<tr><td class="h"><a name="487"></a>487</td><td></td><td></td><td></td><td></td><td class="s">        if($hh){</td></tr>
<tr><td class="h"><a name="488"></a>488</td><td></td><td></td><td></td><td></td><td class="s">        $out .=   '  ';</td></tr>
<tr><td class="h"><a name="489"></a>489</td><td></td><td></td><td></td><td></td><td class="s">        }</td></tr>
<tr><td class="h"><a name="490"></a>490</td><td></td><td></td><td></td><td></td><td class="s">        }</td></tr>
<tr><td class="h"><a name="491"></a>491</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="492"></a>492</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="493"></a>493</td><td class="c0">138010</td><td class="c0"><span title="Avg 512ns">70.7ms</span></td><td></td><td></td><td class="s">        if($hh){</td></tr>
<tr><td class="h"><a name="494"></a>494</td><td></td><td></td><td></td><td></td><td class="s">        $out .= (($time[2] &lt; 10)?(&quot;0&quot; . $time[2]):$time[2]);</td></tr>
<tr><td class="h"><a name="495"></a>495</td><td></td><td></td><td></td><td></td><td class="s">        if($mmin){</td></tr>
<tr><td class="h"><a name="496"></a>496</td><td></td><td></td><td></td><td></td><td class="s">        $out .= ':';</td></tr>
<tr><td class="h"><a name="497"></a>497</td><td></td><td></td><td></td><td></td><td class="s">        }</td></tr>
<tr><td class="h"><a name="498"></a>498</td><td></td><td></td><td></td><td></td><td class="s">        }</td></tr>
<tr><td class="h"><a name="499"></a>499</td><td class="c0">138010</td><td class="c0"><span title="Avg 341ns">47.0ms</span></td><td></td><td></td><td class="s">        if($mmin){</td></tr>
<tr><td class="h"><a name="500"></a>500</td><td></td><td></td><td></td><td></td><td class="s">        $out .=  (($time[1] &lt; 10)?(&quot;0&quot; . $time[1]):$time[1]);</td></tr>
<tr><td class="h"><a name="501"></a>501</td><td></td><td></td><td></td><td></td><td class="s">        if($ss){</td></tr>
<tr><td class="h"><a name="502"></a>502</td><td></td><td></td><td></td><td></td><td class="s">        $out .=  ':';</td></tr>
<tr><td class="h"><a name="503"></a>503</td><td></td><td></td><td></td><td></td><td class="s">        }</td></tr>
<tr><td class="h"><a name="504"></a>504</td><td></td><td></td><td></td><td></td><td class="s">        }</td></tr>
<tr><td class="h"><a name="505"></a>505</td><td></td><td></td><td></td><td></td><td class="s">        if($ss){</td></tr>
<tr><td class="h"><a name="506"></a>506</td><td></td><td></td><td></td><td></td><td class="s">        $out .= (($time[0] &lt; 10)?(&quot;0&quot; . $time[0]):$time[0]);</td></tr>
<tr><td class="h"><a name="507"></a>507</td><td></td><td></td><td></td><td></td><td class="s">        }</td></tr>
<tr><td class="h"><a name="508"></a>508</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="509"></a>509</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="510"></a>510</td><td></td><td></td><td></td><td></td><td class="s">        return $out;</td></tr>
<tr><td class="h"><a name="511"></a>511</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h"><a name="512"></a>512</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="513"></a>513</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="514"></a>514</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="515"></a>515</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="516"></a>516</td><td></td><td></td><td></td><td></td><td class="s"><div class="calls"><div class="calls_in"># spent 1.20ms within main::round which was called 366 times, avg 3&micro;s/call:
# 366 times (1.20ms+0s) by main::counter at <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#393">line 393</a>, avg 3&micro;s/call</div></div>sub round {</td></tr>
<tr><td class="h"><a name="517"></a>517</td><td class="c0">732</td><td class="c0"><span title="Avg 2&micro;s">1.42ms</span></td><td></td><td></td><td class="s">    my($number) = shift;</td></tr>
<tr><td class="h"><a name="518"></a>518</td><td></td><td></td><td></td><td></td><td class="s">    return int($number + .5);</td></tr>
<tr><td class="h"><a name="519"></a>519</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h"><a name="520"></a>520</td><td></td><td></td><td></td><td></td><td class="s"># Usage: print &quot;54 = &quot; . dec2bin(54) . &quot;\n&quot;;</td></tr>
<tr><td class="h"><a name="521"></a>521</td><td></td><td></td><td></td><td></td><td class="s"># returns: 54 = 110110</td></tr>
<tr><td class="h"><a name="522"></a>522</td><td></td><td></td><td></td><td></td><td class="s">sub dec2bin {</td></tr>
<tr><td class="h"><a name="523"></a>523</td><td></td><td></td><td></td><td></td><td class="s">    my $str = unpack(&quot;B32&quot;, pack(&quot;N&quot;, shift));</td></tr>
<tr><td class="h"><a name="524"></a>524</td><td></td><td></td><td></td><td></td><td class="s">    #$str =~ s/^0+(?=\d)//;   # otherwise you'll get leading zeros</td></tr>
<tr><td class="h"><a name="525"></a>525</td><td></td><td></td><td></td><td></td><td class="s">    $str = substr($str, -8); # used substr instead to pad to 8bit</td></tr>
<tr><td class="h"><a name="526"></a>526</td><td></td><td></td><td></td><td></td><td class="s">    return $str;</td></tr>
<tr><td class="h"><a name="527"></a>527</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h"><a name="528"></a>528</td><td></td><td></td><td></td><td></td><td class="s"># usage: print &quot;0110110 = &quot; . bin2dec('0110110') . &quot;\n&quot;;</td></tr>
<tr><td class="h"><a name="529"></a>529</td><td></td><td></td><td></td><td></td><td class="s"># returns: 0110110 = 54</td></tr>
<tr><td class="h"><a name="530"></a>530</td><td></td><td></td><td></td><td></td><td class="s">sub bin2dec {</td></tr>
<tr><td class="h"><a name="531"></a>531</td><td></td><td></td><td></td><td></td><td class="s">    return unpack(&quot;N&quot;, pack(&quot;B32&quot;, substr(&quot;0&quot; x 32 . shift, -32)));</td></tr>
<tr><td class="h"><a name="532"></a>532</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h"><a name="533"></a>533</td><td></td><td></td><td></td><td></td><td class="s"><div class="calls"><div class="calls_in"># spent 5.45s (3.52+1.93) within main::do_msg which was called 68085 times, avg 80&micro;s/call:
# 68085 times (3.52s+1.93s) by main::counter at <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#330">line 330</a>, avg 80&micro;s/call</div></div>sub do_msg {</td></tr>
<tr><td class="h"><a name="534"></a>534</td><td class="c0">544680</td><td class="c0"><span title="Avg 4&micro;s">2.44s</span></td><td></td><td></td><td class="s">    $msg = shift;</td></tr>
<tr><td class="h"><a name="535"></a>535</td><td class="c0">136170</td><td class="c0"><span title="Avg 252ns">34.3ms</span></td><td></td><td></td><td class="s">    if (!$qsize) {</td></tr>
<tr><td class="h"><a name="536"></a>536</td><td></td><td></td><td></td><td></td><td class="s">        $blog-&gt;info( &quot;\n\nINCOMING MESSAGE:\n$msg\n&quot;) if ($debug &gt; 0);</td></tr>
<tr><td class="h"><a name="537"></a>537</td><td></td><td></td><td></td><td></td><td class="s">        $alog-&gt;debug ( &quot;\n\nINCOMING MESSAGE:\n$msg\n&quot;) if (($debug &gt; 2) and ($verbose));</td></tr>
<tr><td class="h"><a name="538"></a>538</td><td></td><td></td><td></td><td></td><td class="s">    }</td></tr>
<tr><td class="h"><a name="539"></a>539</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="540"></a>540</td><td></td><td></td><td></td><td></td><td class="s">    # Get current date and time</td></tr>
<tr><td class="h"><a name="541"></a>541</td><td></td><td></td><td></td><td></td><td class="s">    $datetime_now = strftime(&quot;%Y-%m-%d %H:%M:%S&quot;, localtime);<div class="calls"><div class="calls_out">    # spent   419ms making 68085 calls to <a href="POSIX-pm-block.html#POSIX__strftime">POSIX::strftime</a>, avg 6&micro;s/call</div></div></td></tr>
<tr><td class="h"><a name="542"></a>542</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="543"></a>543</td><td></td><td></td><td></td><td></td><td class="s">    # Get current date and time minus $dedup_window in seconds (5 minutes by default)</td></tr>
<tr><td class="h"><a name="544"></a>544</td><td></td><td></td><td></td><td></td><td class="s">    $datetime_past = strftime(&quot;%Y-%m-%d %H:%M:%S&quot;, localtime(time - $dedup_window));<div class="calls"><div class="calls_out">    # spent   287ms making 68085 calls to <a href="POSIX-pm-block.html#POSIX__strftime">POSIX::strftime</a>, avg 4&micro;s/call</div></div></td></tr>
<tr><td class="h"><a name="545"></a>545</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="546"></a>546</td><td></td><td></td><td></td><td></td><td class="s">    # Get incoming variables from PIPE</td></tr>
<tr><td class="h"><a name="547"></a>547</td><td class="c0">1906380</td><td class="c0"><span title="Avg 1&micro;s">2.86s</span></td><td class="c0">136170</td><td class="c0">375ms</td><td class="s">    if ($msg =~ /$re_pipe/) {<div class="calls"><div class="calls_out">    # spent   272ms making 68085 calls to <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#main__CORE_match">main::CORE:match</a>, avg 4&micro;s/call
    # spent   103ms making 68085 calls to <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#main__CORE_regcomp">main::CORE:regcomp</a>, avg 2&micro;s/call</div></div></td></tr>
<tr><td class="h"><a name="548"></a>548</td><td></td><td></td><td></td><td></td><td class="s">        # v3.0 Fields are: Host, PRI, Unix TS, Program,  and MSG</td></tr>
<tr><td class="h"><a name="549"></a>549</td><td></td><td></td><td></td><td></td><td class="s">        $host = $1;</td></tr>
<tr><td class="h"><a name="550"></a>550</td><td></td><td></td><td></td><td></td><td class="s">        $pri = $2;</td></tr>
<tr><td class="h"><a name="551"></a>551</td><td></td><td></td><td></td><td></td><td class="s">        $facility = int($pri/8);</td></tr>
<tr><td class="h"><a name="552"></a>552</td><td></td><td></td><td></td><td></td><td class="s">        $severity =  $pri - ($facility * 8 );</td></tr>
<tr><td class="h"><a name="553"></a>553</td><td></td><td></td><td></td><td></td><td class="s">        $unixtime = $3;</td></tr>
<tr><td class="h"><a name="554"></a>554</td><td></td><td></td><td></td><td></td><td class="s">        $prg = $4;</td></tr>
<tr><td class="h"><a name="555"></a>555</td><td></td><td></td><td></td><td></td><td class="s">        $msg = $5;</td></tr>
<tr><td class="h"><a name="556"></a>556</td><td></td><td></td><td></td><td></td><td class="s">        $msg =~ s/\\//; # Some messages come in with a trailing slash<div class="calls"><div class="calls_out">        # spent  47.1ms making 68085 calls to <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#main__CORE_subst">main::CORE:subst</a>, avg 692ns/call</div></div></td></tr>
<tr><td class="h"><a name="557"></a>557</td><td></td><td></td><td></td><td></td><td class="s">        $msg =~ s/'//; # remove any ''s<div class="calls"><div class="calls_out">        # spent  24.7ms making 68085 calls to <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#main__CORE_subst">main::CORE:subst</a>, avg 363ns/call</div></div></td></tr>
<tr><td class="h"><a name="558"></a>558</td><td></td><td></td><td></td><td></td><td class="s">        $msg =~ s/\t/ /g; # remove any TABs<div class="calls"><div class="calls_out">        # spent  22.8ms making 68085 calls to <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#main__CORE_subst">main::CORE:subst</a>, avg 335ns/call</div></div></td></tr>
<tr><td class="h"><a name="559"></a>559</td><td class="c0">19</td><td class="c3"><span title="Avg 558ns">11&micro;s</span></td><td class="c0">68085</td><td class="c0">276ms</td><td class="s">        if ($msg =~ /%(\w+-.*\d-\w+):/) {<div class="calls"><div class="calls_out">        # spent   276ms making 68085 calls to <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#main__CORE_match">main::CORE:match</a>, avg 4&micro;s/call</div></div></td></tr>
<tr><td class="h"><a name="560"></a>560</td><td></td><td></td><td></td><td></td><td class="s">            $mne = $1;</td></tr>
<tr><td class="h"><a name="561"></a>561</td><td></td><td></td><td></td><td></td><td class="s">        } else {</td></tr>
<tr><td class="h"><a name="562"></a>562</td><td></td><td></td><td></td><td></td><td class="s">            $mne = &quot;None&quot;;</td></tr>
<tr><td class="h"><a name="563"></a>563</td><td></td><td></td><td></td><td></td><td class="s">        }</td></tr>
<tr><td class="h"><a name="564"></a>564</td><td></td><td></td><td></td><td></td><td class="s">        $msg =~ s/[\x00-\x1F\x80-\xFF]//; # Remove any non-printable characters<div class="calls"><div class="calls_out">        # spent  70.1ms making 68085 calls to <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#main__CORE_subst">main::CORE:subst</a>, avg 1&micro;s/call</div></div></td></tr>
<tr><td class="h"><a name="565"></a>565</td><td></td><td></td><td></td><td></td><td class="s">        $prg =~ s/%ACE.*\d+/Cisco ACE/; # Added because ACE modules don't send their program field properly<div class="calls"><div class="calls_out">        # spent  19.7ms making 68085 calls to <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#main__CORE_subst">main::CORE:subst</a>, avg 289ns/call</div></div></td></tr>
<tr><td class="h"><a name="566"></a>566</td><td></td><td></td><td></td><td></td><td class="s">        $prg =~ s/%ASA.*\d+/Cisco ASA/; # Added because ASA's don't send their program field properly<div class="calls"><div class="calls_out">        # spent  14.6ms making 68085 calls to <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#main__CORE_subst">main::CORE:subst</a>, avg 215ns/call</div></div></td></tr>
<tr><td class="h"><a name="567"></a>567</td><td></td><td></td><td></td><td></td><td class="s">        $prg =~ s/%FWSM.*\d+/Cisco FWSM/; # Added because FWSM's don't send their program field properly<div class="calls"><div class="calls_out">        # spent  17.1ms making 68085 calls to <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#main__CORE_subst">main::CORE:subst</a>, avg 251ns/call</div></div></td></tr>
<tr><td class="h"><a name="568"></a>568</td><td></td><td></td><td></td><td></td><td class="s">        $prg =~ s/date=\d+-\d+-\d+/Fortigate Firewall/; # Added because Fortigate's don't follow IETF standards<div class="calls"><div class="calls_out">        # spent  18.8ms making 68085 calls to <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#main__CORE_subst">main::CORE:subst</a>, avg 276ns/call</div></div></td></tr>
<tr><td class="h"><a name="569"></a>569</td><td></td><td></td><td></td><td></td><td class="s">        $msg =~ s/time=\d+:\d+:\d+\s//; # Added because Fortigate's don't s follow IETF standards<div class="calls"><div class="calls_out">        # spent  23.7ms making 68085 calls to <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#main__CORE_subst">main::CORE:subst</a>, avg 348ns/call</div></div></td></tr>
<tr><td class="h"><a name="570"></a>570</td><td></td><td></td><td></td><td></td><td class="s">        @msgs = split(/:/, $msg);</td></tr>
<tr><td class="h"><a name="571"></a>571</td><td></td><td></td><td></td><td></td><td class="s">        if ($prg =~ /^\d+/) { # Some messages come in with the sequence as the PROGRAM field<div class="calls"><div class="calls_out">        # spent  59.8ms making 68085 calls to <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#main__CORE_match">main::CORE:match</a>, avg 878ns/call</div></div></td></tr>
<tr><td class="h"><a name="572"></a>572</td><td></td><td></td><td></td><td></td><td class="s">            $prg = &quot;Cisco Syslog&quot;;</td></tr>
<tr><td class="h"><a name="573"></a>573</td><td></td><td></td><td></td><td></td><td class="s">        }</td></tr>
<tr><td class="h"><a name="574"></a>574</td><td></td><td></td><td></td><td></td><td class="s">        if (!$prg) {</td></tr>
<tr><td class="h"><a name="575"></a>575</td><td></td><td></td><td></td><td></td><td class="s">            $prg = &quot;Syslog&quot;;</td></tr>
<tr><td class="h"><a name="576"></a>576</td><td></td><td></td><td></td><td></td><td class="s">        }</td></tr>
<tr><td class="h"><a name="577"></a>577</td><td></td><td></td><td></td><td></td><td class="s">        # Added below to strip paths from program names so that just the program is listed</td></tr>
<tr><td class="h"><a name="578"></a>578</td><td></td><td></td><td></td><td></td><td class="s">        # i.e.: /USR/SBIN/CRON would be inserted into the DB as just CRON</td></tr>
<tr><td class="h"><a name="579"></a>579</td><td></td><td></td><td></td><td></td><td class="s">        if ($prg =~ /\//) { <div class="calls"><div class="calls_out">        # spent  27.9ms making 68085 calls to <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#main__CORE_match">main::CORE:match</a>, avg 409ns/call
        # spent    58&micro;s making     2 calls to <a href="File-Basename-pm-block.html#104">File::Basename::fileparse</a>, avg 29&micro;s/call</div></div></td></tr>
<tr><td class="h"><a name="580"></a>580</td><td></td><td></td><td></td><td></td><td class="s">            $prg = fileparse($prg);</td></tr>
<tr><td class="h"><a name="581"></a>581</td><td></td><td></td><td></td><td></td><td class="s">        }</td></tr>
<tr><td class="h"><a name="582"></a>582</td><td></td><td></td><td></td><td></td><td class="s">        # Below is an attempt to grab the SEQ id </td></tr>
<tr><td class="h"><a name="583"></a>583</td><td></td><td></td><td></td><td></td><td class="s">        # Note: sequence numbers really are best effort</td></tr>
<tr><td class="h"><a name="584"></a>584</td><td></td><td></td><td></td><td></td><td class="s">        # To enable sequence numbers on a cisco device, use &quot;service sequence-numbers&quot;</td></tr>
<tr><td class="h"><a name="585"></a>585</td><td></td><td></td><td></td><td></td><td class="s">        # I may remove the SEQ field from the database altogether in future releases.</td></tr>
<tr><td class="h"><a name="586"></a>586</td><td></td><td></td><td></td><td></td><td class="s">        #if ($msgs[0] =~ /^\d+/) { </td></tr>
<tr><td class="h"><a name="587"></a>587</td><td></td><td></td><td></td><td></td><td class="s">        #        $seq = $msgs[0];</td></tr>
<tr><td class="h"><a name="588"></a>588</td><td></td><td></td><td></td><td></td><td class="s">        #}</td></tr>
<tr><td class="h"><a name="589"></a>589</td><td></td><td></td><td></td><td></td><td class="s">        #$msg =~ s/^$seq\s?:\s?//; # Remove SEQ from the message if it exists</td></tr>
<tr><td class="h"><a name="590"></a>590</td><td></td><td></td><td></td><td></td><td class="s">        #if ($seq !~ /\d/) {</td></tr>
<tr><td class="h"><a name="591"></a>591</td><td></td><td></td><td></td><td></td><td class="s">        #        $seq = 0;</td></tr>
<tr><td class="h"><a name="592"></a>592</td><td></td><td></td><td></td><td></td><td class="s">        #}</td></tr>
<tr><td class="h"><a name="593"></a>593</td><td></td><td></td><td></td><td></td><td class="s">        $prg32 = crc32(&quot;$prg&quot;);<div class="calls"><div class="calls_out">        # spent   160ms making 68085 calls to <a >String::CRC32::crc32</a>, avg 2&micro;s/call</div></div></td></tr>
<tr><td class="h"><a name="594"></a>594</td><td></td><td></td><td></td><td></td><td class="s">        $mne32 = crc32(&quot;$mne&quot;);<div class="calls"><div class="calls_out">        # spent  68.1ms making 68085 calls to <a >String::CRC32::crc32</a>, avg 1&micro;s/call</div></div></td></tr>
<tr><td class="h"><a name="595"></a>595</td><td></td><td></td><td></td><td></td><td class="s">        unless ($host_cache{$host}){</td></tr>
<tr><td class="h"><a name="596"></a>596</td><td></td><td></td><td></td><td></td><td class="s">            $host_cache{$host} = ($host);</td></tr>
<tr><td class="h"><a name="597"></a>597</td><td></td><td></td><td></td><td></td><td class="s">        }</td></tr>
<tr><td class="h"><a name="598"></a>598</td><td></td><td></td><td></td><td></td><td class="s">        unless ($mne_cache{$mne}){</td></tr>
<tr><td class="h"><a name="599"></a>599</td><td></td><td></td><td></td><td></td><td class="s">            $mne_cache{$mne} = ($mne32);</td></tr>
<tr><td class="h"><a name="600"></a>600</td><td></td><td></td><td></td><td></td><td class="s">        }</td></tr>
<tr><td class="h"><a name="601"></a>601</td><td></td><td></td><td></td><td></td><td class="s">        unless ($program_cache{$prg}){</td></tr>
<tr><td class="h"><a name="602"></a>602</td><td></td><td></td><td></td><td></td><td class="s">            $program_cache{$prg} = ($prg32);</td></tr>
<tr><td class="h"><a name="603"></a>603</td><td></td><td></td><td></td><td></td><td class="s">        }</td></tr>
<tr><td class="h"><a name="604"></a>604</td><td></td><td></td><td></td><td></td><td class="s">        if ($debug &gt; 0) { </td></tr>
<tr><td class="h"><a name="605"></a>605</td><td></td><td></td><td></td><td></td><td class="s">            $blog-&gt;info(&quot;HOST: $host\nPRI: $pri\nFAC: $facility\nSEV: $severity\nTME: $unixtime\nPRG: $prg\nMSG: $msg\n\nMNE: $mne\n\n&quot;);</td></tr>
<tr><td class="h"><a name="606"></a>606</td><td></td><td></td><td></td><td></td><td class="s">        }</td></tr>
<tr><td class="h"><a name="607"></a>607</td><td></td><td></td><td></td><td></td><td class="s">        if (($debug &gt; 2) and ($verbose)) { </td></tr>
<tr><td class="h"><a name="608"></a>608</td><td></td><td></td><td></td><td></td><td class="s">            $alog-&gt;debug (&quot;HOST: $host\nPRI: $pri\nFAC: $facility\nSEV: $severity\nTME: $unixtime\nPRG: $prg\nMSG: $msg\n\nMNE: $mne\n\n&quot;);</td></tr>
<tr><td class="h"><a name="609"></a>609</td><td></td><td></td><td></td><td></td><td class="s">        }</td></tr>
<tr><td class="h"><a name="610"></a>610</td><td></td><td></td><td></td><td></td><td class="s">    } else {</td></tr>
<tr><td class="h"><a name="611"></a>611</td><td></td><td></td><td></td><td></td><td class="s">        # If something gets inserted wrong from the PIPE we'll set host = blank so we can error out later</td></tr>
<tr><td class="h"><a name="612"></a>612</td><td></td><td></td><td></td><td></td><td class="s">        $host = &quot;&quot;;</td></tr>
<tr><td class="h"><a name="613"></a>613</td><td></td><td></td><td></td><td></td><td class="s">        if (!$qsize) {</td></tr>
<tr><td class="h"><a name="614"></a>614</td><td></td><td></td><td></td><td></td><td class="s">            $blog-&gt;info( &quot;INVALID MESSAGE FORMAT:\n$msg\n&quot;) if ($debug &gt; 0);</td></tr>
<tr><td class="h"><a name="615"></a>615</td><td></td><td></td><td></td><td></td><td class="s">            $alog-&gt;debug (&quot;INVALID MESSAGE FORMAT:\n$msg\n&quot;) if (($debug &gt; 0) and ($verbose));</td></tr>
<tr><td class="h"><a name="616"></a>616</td><td></td><td></td><td></td><td></td><td class="s">        }</td></tr>
<tr><td class="h"><a name="617"></a>617</td><td></td><td></td><td></td><td></td><td class="s">    }</td></tr>
<tr><td class="h"><a name="618"></a>618</td><td></td><td></td><td></td><td></td><td class="s">    # If the SQZ feature is enabled, continue, if not we'll just insert the record afterward</td></tr>
<tr><td class="h"><a name="619"></a>619</td><td></td><td></td><td></td><td></td><td class="s">    if($dedup eq 1) {</td></tr>
<tr><td class="h"><a name="620"></a>620</td><td></td><td></td><td></td><td></td><td class="s">        $insert = 1;</td></tr>
<tr><td class="h"><a name="621"></a>621</td><td></td><td></td><td></td><td></td><td class="s">        $db_select-&gt;{TraceLevel} = 4 if (($debug &gt; 4) and ($verbose));</td></tr>
<tr><td class="h"><a name="622"></a>622</td><td></td><td></td><td></td><td></td><td class="s">        # Select any records between now and $dedup_window seconds ago that match this host, facility, etc.</td></tr>
<tr><td class="h"><a name="623"></a>623</td><td></td><td></td><td></td><td></td><td class="s">        $db_select-&gt;execute($host, $facility, $severity, $prg32, $datetime_past, $datetime_now);</td></tr>
<tr><td class="h"><a name="624"></a>624</td><td></td><td></td><td></td><td></td><td class="s">        if ($db_select-&gt;errstr()) {</td></tr>
<tr><td class="h"><a name="625"></a>625</td><td></td><td></td><td></td><td></td><td class="s">            $blog-&gt;info( &quot;FATAL: Unable to execute SQL statement: &quot; . $db_select-&gt;errstr() . &quot;\n&quot;) if ($debug &gt; 0);</td></tr>
<tr><td class="h"><a name="626"></a>626</td><td></td><td></td><td></td><td></td><td class="s">            $alog-&gt;debug ( &quot;FATAL: Unable to execute SQL statement: &quot; . $db_select-&gt;errstr() . &quot;\n&quot;);</td></tr>
<tr><td class="h"><a name="627"></a>627</td><td></td><td></td><td></td><td></td><td class="s">            #exit;</td></tr>
<tr><td class="h"><a name="628"></a>628</td><td></td><td></td><td></td><td></td><td class="s">        }</td></tr>
<tr><td class="h"><a name="629"></a>629</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="630"></a>630</td><td></td><td></td><td></td><td></td><td class="s">        # For each of the rows obtained above, calculate the likeness of messages using a distance measurement</td></tr>
<tr><td class="h"><a name="631"></a>631</td><td></td><td></td><td></td><td></td><td class="s">        while (my $ref = $db_select-&gt;fetchrow_hashref()) {</td></tr>
<tr><td class="h"><a name="632"></a>632</td><td></td><td></td><td></td><td></td><td class="s">            $distance= distance($ref-&gt;{'msg'},$msg);</td></tr>
<tr><td class="h"><a name="633"></a>633</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="634"></a>634</td><td></td><td></td><td></td><td></td><td class="s">            # If the distance between the two messages is less than $dedup_dist then we'll consider it a match and deduplicate the message</td></tr>
<tr><td class="h"><a name="635"></a>635</td><td></td><td></td><td></td><td></td><td class="s">            if ($distance &lt; $dedup_dist ) {</td></tr>
<tr><td class="h"><a name="636"></a>636</td><td></td><td></td><td></td><td></td><td class="s">                # Store the identical record into an array for later processing</td></tr>
<tr><td class="h"><a name="637"></a>637</td><td></td><td></td><td></td><td></td><td class="s">                push(@rows, $ref-&gt;{'id'});</td></tr>
<tr><td class="h"><a name="638"></a>638</td><td></td><td></td><td></td><td></td><td class="s">                $blog-&gt;info( &quot;A duplicate message was found with database id: &quot;.$ref-&gt;{'id'}.&quot; having a distance of $distance\n&quot;) if ($debug &gt; 3);</td></tr>
<tr><td class="h"><a name="639"></a>639</td><td></td><td></td><td></td><td></td><td class="s">$alog-&gt;debug (&quot;A duplicate message was found with database id: &quot;.$ref-&gt;{'id'}.&quot; having a distance of $distance\n&quot;) if (($debug &gt; 3) and ($verbose));</td></tr>
<tr><td class="h"><a name="640"></a>640</td><td></td><td></td><td></td><td></td><td class="s">            }</td></tr>
<tr><td class="h"><a name="641"></a>641</td><td></td><td></td><td></td><td></td><td class="s">        }</td></tr>
<tr><td class="h"><a name="642"></a>642</td><td></td><td></td><td></td><td></td><td class="s">        # If rows matched above, we're now going to process them for deduplication</td></tr>
<tr><td class="h"><a name="643"></a>643</td><td></td><td></td><td></td><td></td><td class="s">        my $numrows = scalar @rows;</td></tr>
<tr><td class="h"><a name="644"></a>644</td><td></td><td></td><td></td><td></td><td class="s">        if ($numrows &gt; 0) {</td></tr>
<tr><td class="h"><a name="645"></a>645</td><td></td><td></td><td></td><td></td><td class="s">            $blog-&gt;info( &quot;Found $numrows duplicate rows\n&quot;) if ($debug &gt; 3);</td></tr>
<tr><td class="h"><a name="646"></a>646</td><td></td><td></td><td></td><td></td><td class="s">            $alog-&gt;debug ( &quot;Found $numrows duplicate rows\n&quot;) if (($debug &gt; 3) and ($verbose));</td></tr>
<tr><td class="h"><a name="647"></a>647</td><td></td><td></td><td></td><td></td><td class="s">            # Next, sort the row id's so that we know the oldest in order to update it later (we only want to update the oldest row and delete the newer ones that are duplicates)</td></tr>
<tr><td class="h"><a name="648"></a>648</td><td></td><td></td><td></td><td></td><td class="s">            @rows = sort @rows; </td></tr>
<tr><td class="h"><a name="649"></a>649</td><td></td><td></td><td></td><td></td><td class="s">            # Set the first row as the update row and grab info</td></tr>
<tr><td class="h"><a name="650"></a>650</td><td></td><td></td><td></td><td></td><td class="s">            my $update_id = $rows[0];</td></tr>
<tr><td class="h"><a name="651"></a>651</td><td></td><td></td><td></td><td></td><td class="s">            $db_select_id-&gt;execute($update_id);</td></tr>
<tr><td class="h"><a name="652"></a>652</td><td></td><td></td><td></td><td></td><td class="s">            while (my $ref = $db_select_id-&gt;fetchrow_hashref()) {</td></tr>
<tr><td class="h"><a name="653"></a>653</td><td></td><td></td><td></td><td></td><td class="s">                $fo = $ref-&gt;{'fo'};</td></tr>
<tr><td class="h"><a name="654"></a>654</td><td></td><td></td><td></td><td></td><td class="s">                # If FO doesn't exist, then set the current datetime instead.</td></tr>
<tr><td class="h"><a name="655"></a>655</td><td></td><td></td><td></td><td></td><td class="s">                if (!$fo) { $fo = $datetime_now }</td></tr>
<tr><td class="h"><a name="656"></a>656</td><td></td><td></td><td></td><td></td><td class="s">                push (@fos, $fo);</td></tr>
<tr><td class="h"><a name="657"></a>657</td><td></td><td></td><td></td><td></td><td class="s">            }</td></tr>
<tr><td class="h"><a name="658"></a>658</td><td></td><td></td><td></td><td></td><td class="s">            # Next, for each row found, we're going to select it and get some information such as the fo and counter</td></tr>
<tr><td class="h"><a name="659"></a>659</td><td></td><td></td><td></td><td></td><td class="s">            for (my $i=0; $i &lt;= $#rows; $i++) {</td></tr>
<tr><td class="h"><a name="660"></a>660</td><td></td><td></td><td></td><td></td><td class="s">                $blog-&gt;info( &quot;Processing rows:\n\tSource: $rows[0]\n\tCurrent: $rows[$i]\n&quot;) if ($debug &gt; 3);</td></tr>
<tr><td class="h"><a name="661"></a>661</td><td></td><td></td><td></td><td></td><td class="s">                $alog-&gt;debug ( &quot;Processing rows:\n\tSource: $rows[0]\n\tCurrent: $rows[$i]\n&quot;) if (($debug &gt; 3) and ($verbose));</td></tr>
<tr><td class="h"><a name="662"></a>662</td><td></td><td></td><td></td><td></td><td class="s">                $db_select_id-&gt;execute($rows[$i]);</td></tr>
<tr><td class="h"><a name="663"></a>663</td><td></td><td></td><td></td><td></td><td class="s">                while (my $ref = $db_select_id-&gt;fetchrow_hashref()) {</td></tr>
<tr><td class="h"><a name="664"></a>664</td><td></td><td></td><td></td><td></td><td class="s">                    $blog-&gt;info( &quot;Counter from DBID $rows[$i] = &quot;.$ref-&gt;{'counter'}.&quot;\n&quot;) if ($debug &gt; 3);</td></tr>
<tr><td class="h"><a name="665"></a>665</td><td></td><td></td><td></td><td></td><td class="s">                    $alog-&gt;debug ( &quot;Counter from DBID $rows[$i] = &quot;.$ref-&gt;{'counter'}.&quot;\n&quot;) if (($debug &gt; 3) and ($verbose));</td></tr>
<tr><td class="h"><a name="666"></a>666</td><td></td><td></td><td></td><td></td><td class="s">                    $counter = ($counter + $ref-&gt;{'counter'});</td></tr>
<tr><td class="h"><a name="667"></a>667</td><td></td><td></td><td></td><td></td><td class="s">                    $blog-&gt;info( &quot;New Counter = $counter\n&quot;) if ($debug &gt; 3);</td></tr>
<tr><td class="h"><a name="668"></a>668</td><td></td><td></td><td></td><td></td><td class="s">        $alog-&gt;debug ( &quot;New Counter = $counter\n&quot;) if (($debug &gt; 3) and ($verbose));</td></tr>
<tr><td class="h"><a name="669"></a>669</td><td></td><td></td><td></td><td></td><td class="s">                }</td></tr>
<tr><td class="h"><a name="670"></a>670</td><td></td><td></td><td></td><td></td><td class="s">                # Sort the arrays so that we get the first ones</td></tr>
<tr><td class="h"><a name="671"></a>671</td><td></td><td></td><td></td><td></td><td class="s">                @fos = sort @fos; </td></tr>
<tr><td class="h"><a name="672"></a>672</td><td></td><td></td><td></td><td></td><td class="s">                $fo = $fos[0];</td></tr>
<tr><td class="h"><a name="673"></a>673</td><td></td><td></td><td></td><td></td><td class="s">                # if the row returned is greater than 0 (i.e. not the FIRST record) then delete it as a duplicate.</td></tr>
<tr><td class="h"><a name="674"></a>674</td><td></td><td></td><td></td><td></td><td class="s">                # Skip the first record (which will be the source ID)</td></tr>
<tr><td class="h"><a name="675"></a>675</td><td></td><td></td><td></td><td></td><td class="s">                if ($rows[0] != $rows[$i]) {</td></tr>
<tr><td class="h"><a name="676"></a>676</td><td></td><td></td><td></td><td></td><td class="s">                    $blog-&gt;info( &quot;DELETING DB Record: $rows[$i] which is a duplicate record of $rows[0]\n&quot;) if ($debug &gt; 3);</td></tr>
<tr><td class="h"><a name="677"></a>677</td><td></td><td></td><td></td><td></td><td class="s">                    $alog-&gt;debug ( &quot;DELETING DB Record: $rows[$i] which is a duplicate record of $rows[0]\n&quot;) if (($debug &gt; 3) and ($verbose));</td></tr>
<tr><td class="h"><a name="678"></a>678</td><td></td><td></td><td></td><td></td><td class="s">                    $db_del-&gt;execute($rows[$i]);</td></tr>
<tr><td class="h"><a name="679"></a>679</td><td></td><td></td><td></td><td></td><td class="s">                }</td></tr>
<tr><td class="h"><a name="680"></a>680</td><td></td><td></td><td></td><td></td><td class="s">                # Else, if the row returned is the FIRST record, we need to update it with new counter, fo and lo</td></tr>
<tr><td class="h"><a name="681"></a>681</td><td></td><td></td><td></td><td></td><td class="s">                $blog-&gt;info( &quot;UPDATING DB Record: $update_id with new counter and timestamps\n&quot;) if ($debug &gt; 3);</td></tr>
<tr><td class="h"><a name="682"></a>682</td><td></td><td></td><td></td><td></td><td class="s">                $alog-&gt;debug ( &quot;UPDATING DB Record: $update_id with new counter and timestamps\n&quot;) if (($debug &gt; 3) and ($verbose));</td></tr>
<tr><td class="h"><a name="683"></a>683</td><td></td><td></td><td></td><td></td><td class="s">                $do_msg_mps++;</td></tr>
<tr><td class="h"><a name="684"></a>684</td><td></td><td></td><td></td><td></td><td class="s">                $db_update-&gt;execute($counter,$fo,$datetime_now,$update_id);</td></tr>
<tr><td class="h"><a name="685"></a>685</td><td></td><td></td><td></td><td></td><td class="s">            }</td></tr>
<tr><td class="h"><a name="686"></a>686</td><td></td><td></td><td></td><td></td><td class="s">            # Since we've already done an update of the first record, we don't need to insert anything after this</td></tr>
<tr><td class="h"><a name="687"></a>687</td><td></td><td></td><td></td><td></td><td class="s">            $insert = 0;</td></tr>
<tr><td class="h"><a name="688"></a>688</td><td></td><td></td><td></td><td></td><td class="s">            # reset vars for new loop</td></tr>
<tr><td class="h"><a name="689"></a>689</td><td></td><td></td><td></td><td></td><td class="s">            @rows =();</td></tr>
<tr><td class="h"><a name="690"></a>690</td><td></td><td></td><td></td><td></td><td class="s">            @fos = ();</td></tr>
<tr><td class="h"><a name="691"></a>691</td><td></td><td></td><td></td><td></td><td class="s">            $counter = 1;</td></tr>
<tr><td class="h"><a name="692"></a>692</td><td></td><td></td><td></td><td></td><td class="s">        }</td></tr>
<tr><td class="h"><a name="693"></a>693</td><td></td><td></td><td></td><td></td><td class="s">    }</td></tr>
<tr><td class="h"><a name="694"></a>694</td><td></td><td></td><td></td><td></td><td class="s">    # Now that the distance test is over we need to insert any new records that either didn't previously exist or because we had the dedup feature disabled</td></tr>
<tr><td class="h"><a name="695"></a>695</td><td class="c0">68085</td><td class="c0"><span title="Avg 3&micro;s">171ms</span></td><td></td><td></td><td class="s">    if ($insert != 0) {</td></tr>
<tr><td class="h"><a name="696"></a>696</td><td></td><td></td><td></td><td></td><td class="s">        if ($host ne &quot;&quot;)  {</td></tr>
<tr><td class="h"><a name="697"></a>697</td><td></td><td></td><td></td><td></td><td class="s">            $queue = &quot;$host\t$facility\t$severity\t$prg32\t$msg\t$mne32\t$datetime_now\t$datetime_now\t\n&quot;;</td></tr>
<tr><td class="h"><a name="698"></a>698</td><td></td><td></td><td></td><td></td><td class="s">        } else {</td></tr>
<tr><td class="h"><a name="699"></a>699</td><td></td><td></td><td></td><td></td><td class="s">            if (!$qsize) {</td></tr>
<tr><td class="h"><a name="700"></a>700</td><td></td><td></td><td></td><td></td><td class="s">                $do_msg_mps++;</td></tr>
<tr><td class="h"><a name="701"></a>701</td><td></td><td></td><td></td><td></td><td class="s">                $blog-&gt;info(&quot;Error inserting record $msg\n&quot;) if ($debug &gt; 3); </td></tr>
<tr><td class="h"><a name="702"></a>702</td><td></td><td></td><td></td><td></td><td class="s">                $alog-&gt;debug ( &quot;Error inserting record $msg\n&quot;) if (($debug &gt; 3) and ($verbose)); </td></tr>
<tr><td class="h"><a name="703"></a>703</td><td></td><td></td><td></td><td></td><td class="s">            }</td></tr>
<tr><td class="h"><a name="704"></a>704</td><td></td><td></td><td></td><td></td><td class="s">        }</td></tr>
<tr><td class="h"><a name="705"></a>705</td><td></td><td></td><td></td><td></td><td class="s">    } else {</td></tr>
<tr><td class="h"><a name="706"></a>706</td><td></td><td></td><td></td><td></td><td class="s">        $blog-&gt;info( &quot;insert = $insert, Skipping insert of this message since it was a duplicate\n&quot;) if ($debug &gt; 3);</td></tr>
<tr><td class="h"><a name="707"></a>707</td><td></td><td></td><td></td><td></td><td class="s">        $alog-&gt;debug ( &quot;insert = $insert, Skipping insert of this message since it was a duplicate\n&quot;) if (($debug &gt; 3) and ($verbose));</td></tr>
<tr><td class="h"><a name="708"></a>708</td><td></td><td></td><td></td><td></td><td class="s">    }</td></tr>
<tr><td class="h"><a name="709"></a>709</td><td></td><td></td><td></td><td></td><td class="s">    return $queue;</td></tr>
<tr><td class="h"><a name="710"></a>710</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h"><a name="main__CORE_close"></a></td><td></td><td></td><td></td><td></td><td class="s"><div class="calls"><div class="calls_in"># spent 1.68ms within main::CORE:close which was called 184 times, avg 9&micro;s/call:
# 182 times (1.67ms+0s) by main::counter at <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#363">line 363 of /www/svn/logzilla/scripts/db_inse.pl</a>, avg 9&micro;s/call
#      once (6&micro;s+0s) by main::RUNTIME at <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#96">line 96 of /www/svn/logzilla/scripts/db_inse.pl</a>
#      once (4&micro;s+0s) by main::RUNTIME at <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#230">line 230 of /www/svn/logzilla/scripts/db_inse.pl</a></div></div>sub main::CORE:close; # xsub<br />        </td></tr>
<tr><td class="h"><a name="main__CORE_ftdir"></a></td><td></td><td></td><td></td><td></td><td class="s"><div class="calls"><div class="calls_in"># spent 3&micro;s within main::CORE:ftdir which was called
#    once (3&micro;s+0s) by main::RUNTIME at <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#170">line 170 of /www/svn/logzilla/scripts/db_inse.pl</a></div></div>sub main::CORE:ftdir; # xsub<br />        </td></tr>
<tr><td class="h"><a name="main__CORE_ftfile"></a></td><td></td><td></td><td></td><td></td><td class="s"><div class="calls"><div class="calls_in"># spent 12&micro;s within main::CORE:ftfile which was called 2 times, avg 6&micro;s/call:
#    once (10&micro;s+0s) by main::RUNTIME at <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#90">line 90 of /www/svn/logzilla/scripts/db_inse.pl</a>
#    once (2&micro;s+0s) by main::RUNTIME at <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#178">line 178 of /www/svn/logzilla/scripts/db_inse.pl</a></div></div>sub main::CORE:ftfile; # xsub<br />        </td></tr>
<tr><td class="h"><a name="main__CORE_match"></a></td><td></td><td></td><td></td><td></td><td class="s"><div class="calls"><div class="calls_in"># spent 668ms within main::CORE:match which was called 278327 times, avg 2&micro;s/call:
# 68085 times (276ms+0s) by main::do_msg at <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#559">line 559 of /www/svn/logzilla/scripts/db_inse.pl</a>, avg 4&micro;s/call
# 68085 times (272ms+0s) by main::do_msg at <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#547">line 547 of /www/svn/logzilla/scripts/db_inse.pl</a>, avg 4&micro;s/call
# 68085 times (59.8ms+0s) by main::do_msg at <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#571">line 571 of /www/svn/logzilla/scripts/db_inse.pl</a>, avg 878ns/call
# 68085 times (27.9ms+0s) by main::do_msg at <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#579">line 579 of /www/svn/logzilla/scripts/db_inse.pl</a>, avg 409ns/call
#  5490 times (32.3ms+0s) by main::counter at <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#353">line 353 of /www/svn/logzilla/scripts/db_inse.pl</a>, avg 6&micro;s/call
#    59 times (34&micro;s+0s) by main::RUNTIME at <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#126">line 126 of /www/svn/logzilla/scripts/db_inse.pl</a>, avg 576ns/call
#    59 times (28&micro;s+0s) by main::RUNTIME at <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#128">line 128 of /www/svn/logzilla/scripts/db_inse.pl</a>, avg 480ns/call
#    59 times (26&micro;s+0s) by main::RUNTIME at <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#132">line 132 of /www/svn/logzilla/scripts/db_inse.pl</a>, avg 437ns/call
#    59 times (25&micro;s+0s) by main::RUNTIME at <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#133">line 133 of /www/svn/logzilla/scripts/db_inse.pl</a>, avg 432ns/call
#    59 times (25&micro;s+0s) by main::RUNTIME at <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#131">line 131 of /www/svn/logzilla/scripts/db_inse.pl</a>, avg 425ns/call
#    59 times (24&micro;s+0s) by main::RUNTIME at <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#129">line 129 of /www/svn/logzilla/scripts/db_inse.pl</a>, avg 414ns/call
#    59 times (24&micro;s+0s) by main::RUNTIME at <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#130">line 130 of /www/svn/logzilla/scripts/db_inse.pl</a>, avg 407ns/call
#    36 times (21&micro;s+0s) by main::RUNTIME at <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#100">line 100 of /www/svn/logzilla/scripts/db_inse.pl</a>, avg 594ns/call
#     8 times (7&micro;s+0s) by main::RUNTIME at <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#101">line 101 of /www/svn/logzilla/scripts/db_inse.pl</a>, avg 913ns/call
#     8 times (6&micro;s+0s) by main::RUNTIME at <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#104">line 104 of /www/svn/logzilla/scripts/db_inse.pl</a>, avg 688ns/call
#     8 times (5&micro;s+0s) by main::RUNTIME at <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#103">line 103 of /www/svn/logzilla/scripts/db_inse.pl</a>, avg 663ns/call
#     8 times (5&micro;s+0s) by main::RUNTIME at <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#102">line 102 of /www/svn/logzilla/scripts/db_inse.pl</a>, avg 662ns/call
#     8 times (5&micro;s+0s) by main::RUNTIME at <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#106">line 106 of /www/svn/logzilla/scripts/db_inse.pl</a>, avg 650ns/call
#     8 times (5&micro;s+0s) by main::RUNTIME at <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#105">line 105 of /www/svn/logzilla/scripts/db_inse.pl</a>, avg 600ns/call</div></div>sub main::CORE:match; # xsub<br />        </td></tr>
<tr><td class="h"><a name="main__CORE_mkdir"></a></td><td></td><td></td><td></td><td></td><td class="s"><div class="calls"><div class="calls_in"># spent 12&micro;s within main::CORE:mkdir which was called
#    once (12&micro;s+0s) by main::RUNTIME at <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#169">line 169 of /www/svn/logzilla/scripts/db_inse.pl</a></div></div>sub main::CORE:mkdir; # xsub<br />        </td></tr>
<tr><td class="h"><a name="main__CORE_open"></a></td><td></td><td></td><td></td><td></td><td class="s"><div class="calls"><div class="calls_in"># spent 7.79ms within main::CORE:open which was called 184 times, avg 42&micro;s/call:
# 182 times (7.74ms+0s) by main::counter at <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#358">line 358 of /www/svn/logzilla/scripts/db_inse.pl</a>, avg 43&micro;s/call
#      once (36&micro;s+0s) by main::RUNTIME at <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#229">line 229 of /www/svn/logzilla/scripts/db_inse.pl</a>
#      once (19&micro;s+0s) by main::RUNTIME at <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#94">line 94 of /www/svn/logzilla/scripts/db_inse.pl</a></div></div>sub main::CORE:open; # xsub<br />        </td></tr>
<tr><td class="h"><a name="main__CORE_print"></a></td><td></td><td></td><td></td><td></td><td class="s"><div class="calls"><div class="calls_in"># spent 22.9ms within main::CORE:print which was called 182 times, avg 126&micro;s/call:
# 182 times (22.9ms+0s) by main::counter at <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#362">line 362 of /www/svn/logzilla/scripts/db_inse.pl</a>, avg 126&micro;s/call</div></div>sub main::CORE:print; # xsub<br />        </td></tr>
<tr><td class="h"><a name="main__CORE_qr"></a></td><td></td><td></td><td></td><td></td><td class="s"><div class="calls"><div class="calls_in"># spent 7&micro;s within main::CORE:qr which was called
#    once (7&micro;s+0s) by main::RUNTIME at <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#191">line 191 of /www/svn/logzilla/scripts/db_inse.pl</a></div></div>sub main::CORE:qr; # xsub<br />        </td></tr>
<tr><td class="h"><a name="main__CORE_readline"></a></td><td></td><td></td><td></td><td></td><td class="s"><div class="calls"><div class="calls_in"># spent 22&micro;s within main::CORE:readline which was called
#    once (22&micro;s+0s) by main::RUNTIME at <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#95">line 95 of /www/svn/logzilla/scripts/db_inse.pl</a></div></div>sub main::CORE:readline; # xsub<br />        </td></tr>
<tr><td class="h"><a name="main__CORE_regcomp"></a></td><td></td><td></td><td></td><td></td><td class="s"><div class="calls"><div class="calls_in"># spent 103ms within main::CORE:regcomp which was called 68085 times, avg 2&micro;s/call:
# 68085 times (103ms+0s) by main::do_msg at <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#547">line 547 of /www/svn/logzilla/scripts/db_inse.pl</a>, avg 2&micro;s/call</div></div>sub main::CORE:regcomp; # xsub<br />        </td></tr>
<tr><td class="h"><a name="main__CORE_subst"></a></td><td></td><td></td><td></td><td></td><td class="s"><div class="calls"><div class="calls_in"># spent 259ms within main::CORE:subst which was called 612765 times, avg 422ns/call:
# 68085 times (70.1ms+0s) by main::do_msg at <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#564">line 564 of /www/svn/logzilla/scripts/db_inse.pl</a>, avg 1&micro;s/call
# 68085 times (47.1ms+0s) by main::do_msg at <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#556">line 556 of /www/svn/logzilla/scripts/db_inse.pl</a>, avg 692ns/call
# 68085 times (24.7ms+0s) by main::do_msg at <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#557">line 557 of /www/svn/logzilla/scripts/db_inse.pl</a>, avg 363ns/call
# 68085 times (23.7ms+0s) by main::do_msg at <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#569">line 569 of /www/svn/logzilla/scripts/db_inse.pl</a>, avg 348ns/call
# 68085 times (22.8ms+0s) by main::do_msg at <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#558">line 558 of /www/svn/logzilla/scripts/db_inse.pl</a>, avg 335ns/call
# 68085 times (19.7ms+0s) by main::do_msg at <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#565">line 565 of /www/svn/logzilla/scripts/db_inse.pl</a>, avg 289ns/call
# 68085 times (18.8ms+0s) by main::do_msg at <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#568">line 568 of /www/svn/logzilla/scripts/db_inse.pl</a>, avg 276ns/call
# 68085 times (17.1ms+0s) by main::do_msg at <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#567">line 567 of /www/svn/logzilla/scripts/db_inse.pl</a>, avg 251ns/call
# 68085 times (14.6ms+0s) by main::do_msg at <a href="www-svn-logzilla-scripts-db_inse-pl-block.html#566">line 566 of /www/svn/logzilla/scripts/db_inse.pl</a>, avg 215ns/call</div></div>sub main::CORE:subst; # xsub<br />        </td></tr>
</tbody></table></div>
        
            <script type="text/javascript"> $(document).ready(function() { 

        $("#subs_table").tablesorter({
            sortList: [[3,1]],
            headers: {
                3: { sorter: 'fmt_time' },
                4: { sorter: 'fmt_time' }
            }
        });
    
 } ); </script>
        
        <div class="footer">Report produced by the
        <a href="http://search.cpan.org/dist/Devel-NYTProf/">NYTProf 3.11</a>
        Perl profiler, developed by
        <a href="http://www.linkedin.com/in/timbunce">Tim Bunce</a> and
        <a href="http://code.nytimes.com">Adam Kaplan</a>.
        </div>
        <br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
    </body></html>